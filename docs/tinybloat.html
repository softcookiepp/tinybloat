<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.4"/>
    <title>tinybloat API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>


            <h2>Submodules</h2>
            <ul>
                    <li><a href="tinybloat/linalg.html">linalg</a></li>
                    <li><a href="tinybloat/safety_functions.html">safety_functions</a></li>
                    <li><a href="tinybloat/nn.html">nn</a></li>
                    <li><a href="tinybloat/F.html">F</a></li>
                    <li><a href="tinybloat/type_utils.html">type_utils</a></li>
                    <li><a href="tinybloat/testing.html">testing</a></li>
            </ul>

            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#ComplexTensor">ComplexTensor</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ComplexTensor.__init__">ComplexTensor</a>
                        </li>
                        <li>
                                <a class="variable" href="#ComplexTensor.real">real</a>
                        </li>
                        <li>
                                <a class="variable" href="#ComplexTensor.imag">imag</a>
                        </li>
                        <li>
                                <a class="variable" href="#ComplexTensor.device">device</a>
                        </li>
                        <li>
                                <a class="variable" href="#ComplexTensor.ndim">ndim</a>
                        </li>
                        <li>
                                <a class="variable" href="#ComplexTensor.T">T</a>
                        </li>
                        <li>
                                <a class="variable" href="#ComplexTensor.shape">shape</a>
                        </li>
                        <li>
                                <a class="variable" href="#ComplexTensor.dtype">dtype</a>
                        </li>
                        <li>
                                <a class="function" href="#ComplexTensor.to">to</a>
                        </li>
                        <li>
                                <a class="function" href="#ComplexTensor.to_">to_</a>
                        </li>
                        <li>
                                <a class="function" href="#ComplexTensor.cast">cast</a>
                        </li>
                        <li>
                                <a class="function" href="#ComplexTensor.numel">numel</a>
                        </li>
                        <li>
                                <a class="function" href="#ComplexTensor.replace">replace</a>
                        </li>
                        <li>
                                <a class="function" href="#ComplexTensor.contiguous">contiguous</a>
                        </li>
                        <li>
                                <a class="function" href="#ComplexTensor.realize">realize</a>
                        </li>
                        <li>
                                <a class="function" href="#ComplexTensor.reshape">reshape</a>
                        </li>
                        <li>
                                <a class="function" href="#ComplexTensor.numpy">numpy</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#diag">diag</a>
            </li>
            <li>
                    <a class="function" href="#is_tinygrad_module">is_tinygrad_module</a>
            </li>
            <li>
                    <a class="function" href="#module_on_device">module_on_device</a>
            </li>
            <li>
                    <a class="function" href="#move_to_device">move_to_device</a>
            </li>
            <li>
                    <a class="function" href="#cast_to_dtype">cast_to_dtype</a>
            </li>
            <li>
                    <a class="function" href="#nonzero">nonzero</a>
            </li>
            <li>
                    <a class="function" href="#cat">cat</a>
            </li>
            <li>
                    <a class="function" href="#cumprod">cumprod</a>
            </li>
            <li>
                    <a class="function" href="#assert_same_device">assert_same_device</a>
            </li>
            <li>
                    <a class="function" href="#chunk">chunk</a>
            </li>
            <li>
                    <a class="function" href="#clamp">clamp</a>
            </li>
            <li>
                    <a class="function" href="#stack">stack</a>
            </li>
            <li>
                    <a class="function" href="#outer">outer</a>
            </li>
            <li>
                    <a class="function" href="#limit_float_precision">limit_float_precision</a>
            </li>
            <li>
                    <a class="function" href="#limit_sint_precision">limit_sint_precision</a>
            </li>
            <li>
                    <a class="function" href="#limit_uint_precision">limit_uint_precision</a>
            </li>
            <li>
                    <a class="function" href="#shard_model_">shard_model_</a>
            </li>
            <li>
                    <a class="function" href="#cast_to_supported_and_move_">cast_to_supported_and_move_</a>
            </li>
            <li>
                    <a class="class" href="#QTensor">QTensor</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#QTensor.__init__">QTensor</a>
                        </li>
                        <li>
                                <a class="function" href="#QTensor.dequantize">dequantize</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
tinybloat    </h1>

                        <div class="docstring"><p>A module with extra functionality for tinygrad.
Documentation assumes you have some familiarity tinygrad already,
so if you do you can jump right in!</p>
</div>

                        <input id="mod-tinybloat-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-tinybloat-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a><span class="sd">A module with extra functionality for tinygrad.</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a><span class="sd">Documentation assumes you have some familiarity tinygrad already,</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a><span class="sd">so if you do you can jump right in!</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.complex_tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">ComplexTensor</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.quantization</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">linalg</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.common</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.safety_functions</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">12</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.memory</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">13</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">nn</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">14</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">F</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">15</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.compatibility</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">16</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">type_utils</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">17</span></a>
</span><span id="L-18"><a href="#L-18"><span class="linenos">18</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">19</span></a>	<span class="s2">&quot;linalg&quot;</span><span class="p">,</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">20</span></a>	<span class="s2">&quot;safety_functions&quot;</span><span class="p">,</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">21</span></a>	<span class="s2">&quot;nn&quot;</span><span class="p">,</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">22</span></a>	<span class="s2">&quot;F&quot;</span><span class="p">,</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">23</span></a>	<span class="s2">&quot;type_utils&quot;</span><span class="p">,</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">24</span></a>	<span class="s2">&quot;testing&quot;</span><span class="p">,</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">25</span></a>	
</span><span id="L-26"><a href="#L-26"><span class="linenos">26</span></a>	<span class="s2">&quot;ComplexTensor&quot;</span><span class="p">,</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">27</span></a>	<span class="s2">&quot;diag&quot;</span><span class="p">,</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">28</span></a>	<span class="s2">&quot;is_tinygrad_module&quot;</span><span class="p">,</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">29</span></a>	<span class="s2">&quot;module_on_device&quot;</span><span class="p">,</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">30</span></a>	<span class="s2">&quot;move_to_device&quot;</span><span class="p">,</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">31</span></a>	<span class="s2">&quot;cast_to_dtype&quot;</span><span class="p">,</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">32</span></a>	<span class="s2">&quot;nonzero&quot;</span><span class="p">,</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">33</span></a>	<span class="s2">&quot;cat&quot;</span><span class="p">,</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">34</span></a>	<span class="s2">&quot;cumprod&quot;</span><span class="p">,</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">35</span></a>	<span class="s2">&quot;assert_same_device&quot;</span><span class="p">,</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">36</span></a>	<span class="s2">&quot;chunk&quot;</span><span class="p">,</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">37</span></a>	<span class="s2">&quot;clamp&quot;</span><span class="p">,</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">38</span></a>	<span class="s2">&quot;stack&quot;</span><span class="p">,</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">39</span></a>	<span class="s2">&quot;outer&quot;</span><span class="p">,</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">40</span></a>	<span class="s2">&quot;limit_float_precision&quot;</span><span class="p">,</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">41</span></a>	<span class="s2">&quot;limit_sint_precision&quot;</span><span class="p">,</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">42</span></a>	<span class="s2">&quot;limit_uint_precision&quot;</span><span class="p">,</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">43</span></a>	<span class="s2">&quot;shard_model_&quot;</span><span class="p">,</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">44</span></a>	<span class="s2">&quot;cast_to_supported_and_move_&quot;</span><span class="p">,</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">45</span></a>	<span class="s2">&quot;QTensor&quot;</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">46</span></a><span class="p">]</span>
</span></pre></div>


            </section>
                <section id="ComplexTensor">
                            <input id="ComplexTensor-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ComplexTensor</span>:

                <label class="view-source-button" for="ComplexTensor-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ComplexTensor"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ComplexTensor-7"><a href="#ComplexTensor-7"><span class="linenos">  7</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ComplexTensor</span><span class="p">:</span>
</span><span id="ComplexTensor-8"><a href="#ComplexTensor-8"><span class="linenos">  8</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ComplexTensor-9"><a href="#ComplexTensor-9"><span class="linenos">  9</span></a><span class="sd">	A tensor class that can be used for operations that require complex numbers.</span>
</span><span id="ComplexTensor-10"><a href="#ComplexTensor-10"><span class="linenos"> 10</span></a><span class="sd">	It stores the real and imaginary components as separate tinygrad tensors, but this</span>
</span><span id="ComplexTensor-11"><a href="#ComplexTensor-11"><span class="linenos"> 11</span></a><span class="sd">	may change if another means of storage is found to be more optimal.</span>
</span><span id="ComplexTensor-12"><a href="#ComplexTensor-12"><span class="linenos"> 12</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="ComplexTensor-13"><a href="#ComplexTensor-13"><span class="linenos"> 13</span></a>	<span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="ComplexTensor-14"><a href="#ComplexTensor-14"><span class="linenos"> 14</span></a>				<span class="n">real</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
</span><span id="ComplexTensor-15"><a href="#ComplexTensor-15"><span class="linenos"> 15</span></a>				<span class="n">imag</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">device</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="ComplexTensor-16"><a href="#ComplexTensor-16"><span class="linenos"> 16</span></a>		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">real</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="ComplexTensor-17"><a href="#ComplexTensor-17"><span class="linenos"> 17</span></a>			<span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">iscomplexobj</span><span class="p">(</span><span class="n">real</span><span class="p">):</span>
</span><span id="ComplexTensor-18"><a href="#ComplexTensor-18"><span class="linenos"> 18</span></a>				<span class="n">real</span><span class="p">,</span> <span class="n">imag</span> <span class="o">=</span> <span class="n">real</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">real</span><span class="o">.</span><span class="n">imag</span>
</span><span id="ComplexTensor-19"><a href="#ComplexTensor-19"><span class="linenos"> 19</span></a>				<span class="n">imag</span> <span class="o">=</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">imag</span><span class="p">,</span> <span class="n">device</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
</span><span id="ComplexTensor-20"><a href="#ComplexTensor-20"><span class="linenos"> 20</span></a>			<span class="n">real</span> <span class="o">=</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">real</span><span class="p">,</span> <span class="n">device</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
</span><span id="ComplexTensor-21"><a href="#ComplexTensor-21"><span class="linenos"> 21</span></a>			<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">imag</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="ComplexTensor-22"><a href="#ComplexTensor-22"><span class="linenos"> 22</span></a>				<span class="n">imag</span> <span class="o">=</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">imag</span><span class="p">,</span> <span class="n">device</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
</span><span id="ComplexTensor-23"><a href="#ComplexTensor-23"><span class="linenos"> 23</span></a>		
</span><span id="ComplexTensor-24"><a href="#ComplexTensor-24"><span class="linenos"> 24</span></a>		<span class="k">if</span> <span class="n">imag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ComplexTensor-25"><a href="#ComplexTensor-25"><span class="linenos"> 25</span></a>			<span class="n">imag</span> <span class="o">=</span> <span class="n">real</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">()</span>
</span><span id="ComplexTensor-26"><a href="#ComplexTensor-26"><span class="linenos"> 26</span></a>		<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">real</span><span class="p">,</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected tinygrad.Tensor, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">real</span><span class="p">)</span><span class="si">}</span><span class="s2"> instead&quot;</span>
</span><span id="ComplexTensor-27"><a href="#ComplexTensor-27"><span class="linenos"> 27</span></a>		<span class="k">if</span> <span class="ow">not</span> <span class="n">device</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ComplexTensor-28"><a href="#ComplexTensor-28"><span class="linenos"> 28</span></a>			<span class="n">real</span> <span class="o">=</span> <span class="n">real</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="ComplexTensor-29"><a href="#ComplexTensor-29"><span class="linenos"> 29</span></a>			<span class="n">imag</span> <span class="o">=</span> <span class="n">imag</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="ComplexTensor-30"><a href="#ComplexTensor-30"><span class="linenos"> 30</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_real</span> <span class="o">=</span> <span class="n">real</span>
</span><span id="ComplexTensor-31"><a href="#ComplexTensor-31"><span class="linenos"> 31</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_imag</span> <span class="o">=</span> <span class="n">imag</span>
</span><span id="ComplexTensor-32"><a href="#ComplexTensor-32"><span class="linenos"> 32</span></a>		<span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_real</span><span class="o">.</span><span class="n">device</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imag</span><span class="o">.</span><span class="n">device</span>
</span><span id="ComplexTensor-33"><a href="#ComplexTensor-33"><span class="linenos"> 33</span></a>	
</span><span id="ComplexTensor-34"><a href="#ComplexTensor-34"><span class="linenos"> 34</span></a>	<span class="nd">@property</span>
</span><span id="ComplexTensor-35"><a href="#ComplexTensor-35"><span class="linenos"> 35</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">real</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="ComplexTensor-36"><a href="#ComplexTensor-36"><span class="linenos"> 36</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ComplexTensor-37"><a href="#ComplexTensor-37"><span class="linenos"> 37</span></a><span class="sd">		The real component of the tensor</span>
</span><span id="ComplexTensor-38"><a href="#ComplexTensor-38"><span class="linenos"> 38</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="ComplexTensor-39"><a href="#ComplexTensor-39"><span class="linenos"> 39</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_real</span>
</span><span id="ComplexTensor-40"><a href="#ComplexTensor-40"><span class="linenos"> 40</span></a>	
</span><span id="ComplexTensor-41"><a href="#ComplexTensor-41"><span class="linenos"> 41</span></a>	<span class="nd">@property</span>
</span><span id="ComplexTensor-42"><a href="#ComplexTensor-42"><span class="linenos"> 42</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">imag</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="ComplexTensor-43"><a href="#ComplexTensor-43"><span class="linenos"> 43</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ComplexTensor-44"><a href="#ComplexTensor-44"><span class="linenos"> 44</span></a><span class="sd">		The imaginary component of the tensor</span>
</span><span id="ComplexTensor-45"><a href="#ComplexTensor-45"><span class="linenos"> 45</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="ComplexTensor-46"><a href="#ComplexTensor-46"><span class="linenos"> 46</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imag</span>
</span><span id="ComplexTensor-47"><a href="#ComplexTensor-47"><span class="linenos"> 47</span></a>	
</span><span id="ComplexTensor-48"><a href="#ComplexTensor-48"><span class="linenos"> 48</span></a>	<span class="nd">@property</span>
</span><span id="ComplexTensor-49"><a href="#ComplexTensor-49"><span class="linenos"> 49</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">device</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ComplexTensor-50"><a href="#ComplexTensor-50"><span class="linenos"> 50</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ComplexTensor-51"><a href="#ComplexTensor-51"><span class="linenos"> 51</span></a><span class="sd">		The device that both the real and imaginary components are stored on.</span>
</span><span id="ComplexTensor-52"><a href="#ComplexTensor-52"><span class="linenos"> 52</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="ComplexTensor-53"><a href="#ComplexTensor-53"><span class="linenos"> 53</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_real</span><span class="o">.</span><span class="n">device</span>
</span><span id="ComplexTensor-54"><a href="#ComplexTensor-54"><span class="linenos"> 54</span></a>		
</span><span id="ComplexTensor-55"><a href="#ComplexTensor-55"><span class="linenos"> 55</span></a>	<span class="nd">@property</span>
</span><span id="ComplexTensor-56"><a href="#ComplexTensor-56"><span class="linenos"> 56</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">ndim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ComplexTensor-57"><a href="#ComplexTensor-57"><span class="linenos"> 57</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_real</span><span class="o">.</span><span class="n">ndim</span>
</span><span id="ComplexTensor-58"><a href="#ComplexTensor-58"><span class="linenos"> 58</span></a>		
</span><span id="ComplexTensor-59"><a href="#ComplexTensor-59"><span class="linenos"> 59</span></a>	<span class="nd">@property</span>
</span><span id="ComplexTensor-60"><a href="#ComplexTensor-60"><span class="linenos"> 60</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">T</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ComplexTensor-61"><a href="#ComplexTensor-61"><span class="linenos"> 61</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ComplexTensor-62"><a href="#ComplexTensor-62"><span class="linenos"> 62</span></a><span class="sd">		See [tinygrad.Tensor.T](https://docs.tinygrad.org/tensor/properties/#tinygrad.Tensor.T)</span>
</span><span id="ComplexTensor-63"><a href="#ComplexTensor-63"><span class="linenos"> 63</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="ComplexTensor-64"><a href="#ComplexTensor-64"><span class="linenos"> 64</span></a>		<span class="k">return</span> <span class="n">ComplexTensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_real</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imag</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="ComplexTensor-65"><a href="#ComplexTensor-65"><span class="linenos"> 65</span></a>		
</span><span id="ComplexTensor-66"><a href="#ComplexTensor-66"><span class="linenos"> 66</span></a>	<span class="nd">@property</span>
</span><span id="ComplexTensor-67"><a href="#ComplexTensor-67"><span class="linenos"> 67</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ComplexTensor-68"><a href="#ComplexTensor-68"><span class="linenos"> 68</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ComplexTensor-69"><a href="#ComplexTensor-69"><span class="linenos"> 69</span></a><span class="sd">		See [tinygrad.Tensor.shape](https://docs.tinygrad.org/tensor/properties/#tinygrad.Tensor.shape)</span>
</span><span id="ComplexTensor-70"><a href="#ComplexTensor-70"><span class="linenos"> 70</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="ComplexTensor-71"><a href="#ComplexTensor-71"><span class="linenos"> 71</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_real</span><span class="o">.</span><span class="n">shape</span>
</span><span id="ComplexTensor-72"><a href="#ComplexTensor-72"><span class="linenos"> 72</span></a>	
</span><span id="ComplexTensor-73"><a href="#ComplexTensor-73"><span class="linenos"> 73</span></a>	<span class="nd">@property</span>
</span><span id="ComplexTensor-74"><a href="#ComplexTensor-74"><span class="linenos"> 74</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ComplexTensor-75"><a href="#ComplexTensor-75"><span class="linenos"> 75</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ComplexTensor-76"><a href="#ComplexTensor-76"><span class="linenos"> 76</span></a><span class="sd">		Unlike numpy or pytorch, tinygrad does not have complex64 and complex128 dtypes.</span>
</span><span id="ComplexTensor-77"><a href="#ComplexTensor-77"><span class="linenos"> 77</span></a><span class="sd">		Because of this, the underlying tinygrad dtype of the real component is returned instead.</span>
</span><span id="ComplexTensor-78"><a href="#ComplexTensor-78"><span class="linenos"> 78</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="ComplexTensor-79"><a href="#ComplexTensor-79"><span class="linenos"> 79</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_real</span><span class="o">.</span><span class="n">dtype</span>
</span><span id="ComplexTensor-80"><a href="#ComplexTensor-80"><span class="linenos"> 80</span></a>		
</span><span id="ComplexTensor-81"><a href="#ComplexTensor-81"><span class="linenos"> 81</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="ComplexTensor-82"><a href="#ComplexTensor-82"><span class="linenos"> 82</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ComplexTensor-83"><a href="#ComplexTensor-83"><span class="linenos"> 83</span></a><span class="sd">		See [tinygrad.Tensor.to()](https://docs.tinygrad.org/tensor/properties/#tinygrad.Tensor.to)</span>
</span><span id="ComplexTensor-84"><a href="#ComplexTensor-84"><span class="linenos"> 84</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="ComplexTensor-85"><a href="#ComplexTensor-85"><span class="linenos"> 85</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tg_override</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="ComplexTensor-86"><a href="#ComplexTensor-86"><span class="linenos"> 86</span></a>	
</span><span id="ComplexTensor-87"><a href="#ComplexTensor-87"><span class="linenos"> 87</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">to_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
</span><span id="ComplexTensor-88"><a href="#ComplexTensor-88"><span class="linenos"> 88</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ComplexTensor-89"><a href="#ComplexTensor-89"><span class="linenos"> 89</span></a><span class="sd">		See [tinygrad.Tensor.to_()](https://docs.tinygrad.org/tensor/properties/#tinygrad.Tensor.to_)</span>
</span><span id="ComplexTensor-90"><a href="#ComplexTensor-90"><span class="linenos"> 90</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="ComplexTensor-91"><a href="#ComplexTensor-91"><span class="linenos"> 91</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_real</span><span class="o">.</span><span class="n">to_</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="ComplexTensor-92"><a href="#ComplexTensor-92"><span class="linenos"> 92</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_imag</span><span class="o">.</span><span class="n">to_</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="ComplexTensor-93"><a href="#ComplexTensor-93"><span class="linenos"> 93</span></a>		<span class="k">return</span> <span class="bp">self</span>
</span><span id="ComplexTensor-94"><a href="#ComplexTensor-94"><span class="linenos"> 94</span></a>	
</span><span id="ComplexTensor-95"><a href="#ComplexTensor-95"><span class="linenos"> 95</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">cast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="ComplexTensor-96"><a href="#ComplexTensor-96"><span class="linenos"> 96</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ComplexTensor-97"><a href="#ComplexTensor-97"><span class="linenos"> 97</span></a><span class="sd">		See [tinygrad.Tensor.cast()](https://docs.tinygrad.org/tensor/properties/#tinygrad.Tensor.cast)</span>
</span><span id="ComplexTensor-98"><a href="#ComplexTensor-98"><span class="linenos"> 98</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="ComplexTensor-99"><a href="#ComplexTensor-99"><span class="linenos"> 99</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tg_override</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="ComplexTensor-100"><a href="#ComplexTensor-100"><span class="linenos">100</span></a>	
</span><span id="ComplexTensor-101"><a href="#ComplexTensor-101"><span class="linenos">101</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">numel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ComplexTensor-102"><a href="#ComplexTensor-102"><span class="linenos">102</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ComplexTensor-103"><a href="#ComplexTensor-103"><span class="linenos">103</span></a><span class="sd">		See [tinygrad.Tensor.numel()](https://docs.tinygrad.org/tensor/properties/#tinygrad.Tensor.numel)</span>
</span><span id="ComplexTensor-104"><a href="#ComplexTensor-104"><span class="linenos">104</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="ComplexTensor-105"><a href="#ComplexTensor-105"><span class="linenos">105</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_real</span><span class="o">.</span><span class="n">numel</span><span class="p">()</span>
</span><span id="ComplexTensor-106"><a href="#ComplexTensor-106"><span class="linenos">106</span></a>	
</span><span id="ComplexTensor-107"><a href="#ComplexTensor-107"><span class="linenos">107</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new</span><span class="p">):</span>
</span><span id="ComplexTensor-108"><a href="#ComplexTensor-108"><span class="linenos">108</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ComplexTensor-109"><a href="#ComplexTensor-109"><span class="linenos">109</span></a><span class="sd">		Replace this tensor with another.</span>
</span><span id="ComplexTensor-110"><a href="#ComplexTensor-110"><span class="linenos">110</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="ComplexTensor-111"><a href="#ComplexTensor-111"><span class="linenos">111</span></a>		<span class="c1"># lets be picky about it for now</span>
</span><span id="ComplexTensor-112"><a href="#ComplexTensor-112"><span class="linenos">112</span></a>		<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">ComplexTensor</span><span class="p">)</span>
</span><span id="ComplexTensor-113"><a href="#ComplexTensor-113"><span class="linenos">113</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_real</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
</span><span id="ComplexTensor-114"><a href="#ComplexTensor-114"><span class="linenos">114</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_imag</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
</span><span id="ComplexTensor-115"><a href="#ComplexTensor-115"><span class="linenos">115</span></a>		<span class="k">return</span> <span class="bp">self</span>
</span><span id="ComplexTensor-116"><a href="#ComplexTensor-116"><span class="linenos">116</span></a>
</span><span id="ComplexTensor-117"><a href="#ComplexTensor-117"><span class="linenos">117</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">_tg_override</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="ComplexTensor-118"><a href="#ComplexTensor-118"><span class="linenos">118</span></a>		<span class="c1"># Method for automatically wrapping stuff coded in tinygrad so</span>
</span><span id="ComplexTensor-119"><a href="#ComplexTensor-119"><span class="linenos">119</span></a>		<span class="c1"># stuff works correctly</span>
</span><span id="ComplexTensor-120"><a href="#ComplexTensor-120"><span class="linenos">120</span></a>		<span class="c1"># This method will apply the given operation to both the real and</span>
</span><span id="ComplexTensor-121"><a href="#ComplexTensor-121"><span class="linenos">121</span></a>		<span class="c1"># imaginary component, so use caution</span>
</span><span id="ComplexTensor-122"><a href="#ComplexTensor-122"><span class="linenos">122</span></a>		
</span><span id="ComplexTensor-123"><a href="#ComplexTensor-123"><span class="linenos">123</span></a>		<span class="c1"># this will be the function that gets wrapped</span>
</span><span id="ComplexTensor-124"><a href="#ComplexTensor-124"><span class="linenos">124</span></a>		<span class="n">tg_attr</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">function</span>
</span><span id="ComplexTensor-125"><a href="#ComplexTensor-125"><span class="linenos">125</span></a>		
</span><span id="ComplexTensor-126"><a href="#ComplexTensor-126"><span class="linenos">126</span></a>		<span class="c1"># ensure all tensors in args and kwar</span>
</span><span id="ComplexTensor-127"><a href="#ComplexTensor-127"><span class="linenos">127</span></a>		<span class="n">real_args</span> <span class="o">=</span> <span class="n">convert_to_real</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span id="ComplexTensor-128"><a href="#ComplexTensor-128"><span class="linenos">128</span></a>		<span class="n">real_kwargs</span> <span class="o">=</span> <span class="n">convert_to_real</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="ComplexTensor-129"><a href="#ComplexTensor-129"><span class="linenos">129</span></a>		
</span><span id="ComplexTensor-130"><a href="#ComplexTensor-130"><span class="linenos">130</span></a>		<span class="n">imag_args</span> <span class="o">=</span> <span class="n">convert_to_imag</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span id="ComplexTensor-131"><a href="#ComplexTensor-131"><span class="linenos">131</span></a>		<span class="n">imag_kwargs</span> <span class="o">=</span> <span class="n">convert_to_imag</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="ComplexTensor-132"><a href="#ComplexTensor-132"><span class="linenos">132</span></a>		
</span><span id="ComplexTensor-133"><a href="#ComplexTensor-133"><span class="linenos">133</span></a>		<span class="c1"># lets just disable this for now...</span>
</span><span id="ComplexTensor-134"><a href="#ComplexTensor-134"><span class="linenos">134</span></a>		<span class="c1">#assert_same_device(self.tg.device, tg_args, tg_kwargs)</span>
</span><span id="ComplexTensor-135"><a href="#ComplexTensor-135"><span class="linenos">135</span></a>		
</span><span id="ComplexTensor-136"><a href="#ComplexTensor-136"><span class="linenos">136</span></a>		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">real_kwargs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ComplexTensor-137"><a href="#ComplexTensor-137"><span class="linenos">137</span></a>			<span class="c1"># fix for methods that don&#39;t support **kwargs</span>
</span><span id="ComplexTensor-138"><a href="#ComplexTensor-138"><span class="linenos">138</span></a>			<span class="n">out_real</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">real</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">tg_attr</span><span class="p">)(</span><span class="o">*</span><span class="n">real_args</span><span class="p">)</span>
</span><span id="ComplexTensor-139"><a href="#ComplexTensor-139"><span class="linenos">139</span></a>			<span class="n">out_imag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imag</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">tg_attr</span><span class="p">)(</span><span class="o">*</span><span class="n">imag_args</span><span class="p">)</span>
</span><span id="ComplexTensor-140"><a href="#ComplexTensor-140"><span class="linenos">140</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="ComplexTensor-141"><a href="#ComplexTensor-141"><span class="linenos">141</span></a>			<span class="n">out_real</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">real</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">tg_attr</span><span class="p">)(</span><span class="o">*</span><span class="n">real_args</span><span class="p">,</span> <span class="o">**</span><span class="n">real_kwargs</span><span class="p">)</span>
</span><span id="ComplexTensor-142"><a href="#ComplexTensor-142"><span class="linenos">142</span></a>			<span class="n">out_imag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imag</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">tg_attr</span><span class="p">)(</span><span class="o">*</span><span class="n">imag_args</span><span class="p">,</span> <span class="o">**</span><span class="n">imag_kwargs</span><span class="p">)</span>
</span><span id="ComplexTensor-143"><a href="#ComplexTensor-143"><span class="linenos">143</span></a>		<span class="k">return</span> <span class="n">ComplexTensor</span><span class="p">(</span><span class="n">out_real</span><span class="p">,</span> <span class="n">out_imag</span><span class="p">)</span>
</span><span id="ComplexTensor-144"><a href="#ComplexTensor-144"><span class="linenos">144</span></a>	
</span><span id="ComplexTensor-145"><a href="#ComplexTensor-145"><span class="linenos">145</span></a>	
</span><span id="ComplexTensor-146"><a href="#ComplexTensor-146"><span class="linenos">146</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">contiguous</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ComplexTensor-147"><a href="#ComplexTensor-147"><span class="linenos">147</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tg_override</span><span class="p">()</span>
</span><span id="ComplexTensor-148"><a href="#ComplexTensor-148"><span class="linenos">148</span></a>	
</span><span id="ComplexTensor-149"><a href="#ComplexTensor-149"><span class="linenos">149</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">realize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ComplexTensor-150"><a href="#ComplexTensor-150"><span class="linenos">150</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tg_override</span><span class="p">()</span>
</span><span id="ComplexTensor-151"><a href="#ComplexTensor-151"><span class="linenos">151</span></a>	
</span><span id="ComplexTensor-152"><a href="#ComplexTensor-152"><span class="linenos">152</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">reshape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="ComplexTensor-153"><a href="#ComplexTensor-153"><span class="linenos">153</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tg_override</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="ComplexTensor-154"><a href="#ComplexTensor-154"><span class="linenos">154</span></a>		
</span><span id="ComplexTensor-155"><a href="#ComplexTensor-155"><span class="linenos">155</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">numpy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ComplexTensor-156"><a href="#ComplexTensor-156"><span class="linenos">156</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ComplexTensor-157"><a href="#ComplexTensor-157"><span class="linenos">157</span></a><span class="sd">		See [tinygrad.Tensor.numpy()](https://docs.tinygrad.org/tensor/properties/#tinygrad.Tensor.numpy)</span>
</span><span id="ComplexTensor-158"><a href="#ComplexTensor-158"><span class="linenos">158</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="ComplexTensor-159"><a href="#ComplexTensor-159"><span class="linenos">159</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">real</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">imag</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span> <span class="p">)</span>
</span><span id="ComplexTensor-160"><a href="#ComplexTensor-160"><span class="linenos">160</span></a>	
</span><span id="ComplexTensor-161"><a href="#ComplexTensor-161"><span class="linenos">161</span></a>	<span class="k">def</span><span class="w"> </span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="ComplexTensor-162"><a href="#ComplexTensor-162"><span class="linenos">162</span></a>		<span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">imag</span>
</span><span id="ComplexTensor-163"><a href="#ComplexTensor-163"><span class="linenos">163</span></a>		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
</span><span id="ComplexTensor-164"><a href="#ComplexTensor-164"><span class="linenos">164</span></a>			<span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">other</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">()</span>
</span><span id="ComplexTensor-165"><a href="#ComplexTensor-165"><span class="linenos">165</span></a>		<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ComplexTensor</span><span class="p">):</span>
</span><span id="ComplexTensor-166"><a href="#ComplexTensor-166"><span class="linenos">166</span></a>			<span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">imag</span>
</span><span id="ComplexTensor-167"><a href="#ComplexTensor-167"><span class="linenos">167</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="ComplexTensor-168"><a href="#ComplexTensor-168"><span class="linenos">168</span></a>			<span class="c1"># assume it is constant lol</span>
</span><span id="ComplexTensor-169"><a href="#ComplexTensor-169"><span class="linenos">169</span></a>			<span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">other</span><span class="p">,</span> <span class="mf">0.0</span>
</span><span id="ComplexTensor-170"><a href="#ComplexTensor-170"><span class="linenos">170</span></a>		<span class="k">return</span> <span class="n">ComplexTensor</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">c</span><span class="p">,</span> <span class="n">b</span> <span class="o">+</span> <span class="n">d</span><span class="p">)</span>
</span><span id="ComplexTensor-171"><a href="#ComplexTensor-171"><span class="linenos">171</span></a>	
</span><span id="ComplexTensor-172"><a href="#ComplexTensor-172"><span class="linenos">172</span></a>	<span class="k">def</span><span class="w"> </span><span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="ComplexTensor-173"><a href="#ComplexTensor-173"><span class="linenos">173</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tg_override</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="ComplexTensor-174"><a href="#ComplexTensor-174"><span class="linenos">174</span></a>	
</span><span id="ComplexTensor-175"><a href="#ComplexTensor-175"><span class="linenos">175</span></a>	<span class="k">def</span><span class="w"> </span><span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="ComplexTensor-176"><a href="#ComplexTensor-176"><span class="linenos">176</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tg_override</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="ComplexTensor-177"><a href="#ComplexTensor-177"><span class="linenos">177</span></a>		
</span><span id="ComplexTensor-178"><a href="#ComplexTensor-178"><span class="linenos">178</span></a>	<span class="k">def</span><span class="w"> </span><span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="ComplexTensor-179"><a href="#ComplexTensor-179"><span class="linenos">179</span></a>		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ComplexTensor</span><span class="p">):</span>
</span><span id="ComplexTensor-180"><a href="#ComplexTensor-180"><span class="linenos">180</span></a>			<span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">imag</span>
</span><span id="ComplexTensor-181"><a href="#ComplexTensor-181"><span class="linenos">181</span></a>			<span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">imag</span>
</span><span id="ComplexTensor-182"><a href="#ComplexTensor-182"><span class="linenos">182</span></a>			<span class="k">return</span> <span class="n">ComplexTensor</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">c</span> <span class="o">-</span> <span class="n">b</span><span class="o">*</span><span class="n">d</span><span class="p">,</span> <span class="n">a</span><span class="o">*</span><span class="n">d</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">c</span><span class="p">)</span>
</span><span id="ComplexTensor-183"><a href="#ComplexTensor-183"><span class="linenos">183</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="ComplexTensor-184"><a href="#ComplexTensor-184"><span class="linenos">184</span></a>			<span class="k">return</span> <span class="n">ComplexTensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">real</span> <span class="o">*</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">imag</span> <span class="o">*</span> <span class="n">other</span><span class="p">)</span>
</span><span id="ComplexTensor-185"><a href="#ComplexTensor-185"><span class="linenos">185</span></a>		
</span><span id="ComplexTensor-186"><a href="#ComplexTensor-186"><span class="linenos">186</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="ComplexTensor-187"><a href="#ComplexTensor-187"><span class="linenos">187</span></a>		<span class="c1"># complex division is a bit more silly</span>
</span><span id="ComplexTensor-188"><a href="#ComplexTensor-188"><span class="linenos">188</span></a>		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ComplexTensor</span><span class="p">):</span>
</span><span id="ComplexTensor-189"><a href="#ComplexTensor-189"><span class="linenos">189</span></a>			<span class="c1"># i totally forgot how to do this, so the logic is from here:</span>
</span><span id="ComplexTensor-190"><a href="#ComplexTensor-190"><span class="linenos">190</span></a>			<span class="c1"># https://www.cuemath.com/numbers/division-of-complex-numbers/</span>
</span><span id="ComplexTensor-191"><a href="#ComplexTensor-191"><span class="linenos">191</span></a>			<span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">imag</span>
</span><span id="ComplexTensor-192"><a href="#ComplexTensor-192"><span class="linenos">192</span></a>			<span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">imag</span>
</span><span id="ComplexTensor-193"><a href="#ComplexTensor-193"><span class="linenos">193</span></a>			
</span><span id="ComplexTensor-194"><a href="#ComplexTensor-194"><span class="linenos">194</span></a>			<span class="n">out_real</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">d</span><span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">d</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span id="ComplexTensor-195"><a href="#ComplexTensor-195"><span class="linenos">195</span></a>			<span class="n">out_imag</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">d</span><span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">d</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span id="ComplexTensor-196"><a href="#ComplexTensor-196"><span class="linenos">196</span></a>			<span class="k">return</span> <span class="n">ComplexTensor</span><span class="p">(</span><span class="n">out_real</span><span class="p">,</span> <span class="n">out_imag</span><span class="p">)</span>
</span><span id="ComplexTensor-197"><a href="#ComplexTensor-197"><span class="linenos">197</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="ComplexTensor-198"><a href="#ComplexTensor-198"><span class="linenos">198</span></a>			<span class="c1"># if complex component is 0, then regular division can be used</span>
</span><span id="ComplexTensor-199"><a href="#ComplexTensor-199"><span class="linenos">199</span></a>			<span class="k">return</span> <span class="n">ComplexTensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">real</span><span class="o">/</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">imag</span><span class="o">/</span><span class="n">other</span><span class="p">)</span>
</span><span id="ComplexTensor-200"><a href="#ComplexTensor-200"><span class="linenos">200</span></a>			
</span><span id="ComplexTensor-201"><a href="#ComplexTensor-201"><span class="linenos">201</span></a>	<span class="k">def</span><span class="w"> </span><span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="ComplexTensor-202"><a href="#ComplexTensor-202"><span class="linenos">202</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__div__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="ComplexTensor-203"><a href="#ComplexTensor-203"><span class="linenos">203</span></a>	
</span><span id="ComplexTensor-204"><a href="#ComplexTensor-204"><span class="linenos">204</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">__rdiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="ComplexTensor-205"><a href="#ComplexTensor-205"><span class="linenos">205</span></a>		<span class="c1"># complex division is a bit more silly</span>
</span><span id="ComplexTensor-206"><a href="#ComplexTensor-206"><span class="linenos">206</span></a>		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ComplexTensor</span><span class="p">):</span>
</span><span id="ComplexTensor-207"><a href="#ComplexTensor-207"><span class="linenos">207</span></a>			<span class="c1"># i totally forgot how to do this, so the logic is from here:</span>
</span><span id="ComplexTensor-208"><a href="#ComplexTensor-208"><span class="linenos">208</span></a>			<span class="c1"># https://www.cuemath.com/numbers/division-of-complex-numbers/</span>
</span><span id="ComplexTensor-209"><a href="#ComplexTensor-209"><span class="linenos">209</span></a>			<span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">imag</span>
</span><span id="ComplexTensor-210"><a href="#ComplexTensor-210"><span class="linenos">210</span></a>			<span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">imag</span>
</span><span id="ComplexTensor-211"><a href="#ComplexTensor-211"><span class="linenos">211</span></a>			
</span><span id="ComplexTensor-212"><a href="#ComplexTensor-212"><span class="linenos">212</span></a>			<span class="n">out_real</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">d</span><span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">d</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span id="ComplexTensor-213"><a href="#ComplexTensor-213"><span class="linenos">213</span></a>			<span class="n">out_imag</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">d</span><span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">d</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span id="ComplexTensor-214"><a href="#ComplexTensor-214"><span class="linenos">214</span></a>			<span class="k">return</span> <span class="n">ComplexTensor</span><span class="p">(</span><span class="n">out_real</span><span class="p">,</span> <span class="n">out_imag</span><span class="p">)</span>
</span><span id="ComplexTensor-215"><a href="#ComplexTensor-215"><span class="linenos">215</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="ComplexTensor-216"><a href="#ComplexTensor-216"><span class="linenos">216</span></a>			<span class="c1"># still gotta do this crap</span>
</span><span id="ComplexTensor-217"><a href="#ComplexTensor-217"><span class="linenos">217</span></a>			<span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">other</span><span class="p">,</span> <span class="mi">0</span>
</span><span id="ComplexTensor-218"><a href="#ComplexTensor-218"><span class="linenos">218</span></a>			<span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">imag</span>
</span><span id="ComplexTensor-219"><a href="#ComplexTensor-219"><span class="linenos">219</span></a>			
</span><span id="ComplexTensor-220"><a href="#ComplexTensor-220"><span class="linenos">220</span></a>			<span class="n">out_real</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">d</span><span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">d</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span id="ComplexTensor-221"><a href="#ComplexTensor-221"><span class="linenos">221</span></a>			<span class="n">out_imag</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">d</span><span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">d</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span id="ComplexTensor-222"><a href="#ComplexTensor-222"><span class="linenos">222</span></a>			<span class="k">return</span> <span class="n">ComplexTensor</span><span class="p">(</span><span class="n">out_real</span><span class="p">,</span> <span class="n">out_imag</span><span class="p">)</span>
</span><span id="ComplexTensor-223"><a href="#ComplexTensor-223"><span class="linenos">223</span></a>	
</span><span id="ComplexTensor-224"><a href="#ComplexTensor-224"><span class="linenos">224</span></a>	<span class="k">def</span><span class="w"> </span><span class="fm">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="ComplexTensor-225"><a href="#ComplexTensor-225"><span class="linenos">225</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rdiv__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="ComplexTensor-226"><a href="#ComplexTensor-226"><span class="linenos">226</span></a>		
</span><span id="ComplexTensor-227"><a href="#ComplexTensor-227"><span class="linenos">227</span></a>	<span class="k">def</span><span class="w"> </span><span class="fm">__matmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="ComplexTensor-228"><a href="#ComplexTensor-228"><span class="linenos">228</span></a>		<span class="c1"># oh god this will be painful</span>
</span><span id="ComplexTensor-229"><a href="#ComplexTensor-229"><span class="linenos">229</span></a>		<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
</span><span id="ComplexTensor-230"><a href="#ComplexTensor-230"><span class="linenos">230</span></a>		
</span><span id="ComplexTensor-231"><a href="#ComplexTensor-231"><span class="linenos">231</span></a>		<span class="n">other</span> <span class="o">=</span> <span class="n">convert_to_complex</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="ComplexTensor-232"><a href="#ComplexTensor-232"><span class="linenos">232</span></a>		
</span><span id="ComplexTensor-233"><a href="#ComplexTensor-233"><span class="linenos">233</span></a>		<span class="c1"># regular multiplication is</span>
</span><span id="ComplexTensor-234"><a href="#ComplexTensor-234"><span class="linenos">234</span></a>		<span class="c1"># a, b = self.real, self.imag</span>
</span><span id="ComplexTensor-235"><a href="#ComplexTensor-235"><span class="linenos">235</span></a>		<span class="c1"># c, d = other.real, other.imag</span>
</span><span id="ComplexTensor-236"><a href="#ComplexTensor-236"><span class="linenos">236</span></a>		<span class="c1"># (a*c - b*d) + i*(a*d + b*c)</span>
</span><span id="ComplexTensor-237"><a href="#ComplexTensor-237"><span class="linenos">237</span></a>		
</span><span id="ComplexTensor-238"><a href="#ComplexTensor-238"><span class="linenos">238</span></a>		<span class="c1"># can we just do this?</span>
</span><span id="ComplexTensor-239"><a href="#ComplexTensor-239"><span class="linenos">239</span></a>		<span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">imag</span>
</span><span id="ComplexTensor-240"><a href="#ComplexTensor-240"><span class="linenos">240</span></a>		<span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">imag</span>
</span><span id="ComplexTensor-241"><a href="#ComplexTensor-241"><span class="linenos">241</span></a>		<span class="n">real</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="nd">@c</span> <span class="o">-</span> <span class="n">b</span><span class="nd">@d</span><span class="p">)</span>
</span><span id="ComplexTensor-242"><a href="#ComplexTensor-242"><span class="linenos">242</span></a>		<span class="n">imag</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="nd">@d</span> <span class="o">+</span> <span class="n">b</span><span class="nd">@c</span><span class="p">)</span>
</span><span id="ComplexTensor-243"><a href="#ComplexTensor-243"><span class="linenos">243</span></a>		<span class="c1"># looks like it!</span>
</span><span id="ComplexTensor-244"><a href="#ComplexTensor-244"><span class="linenos">244</span></a>		<span class="k">return</span> <span class="n">ComplexTensor</span><span class="p">(</span><span class="n">real</span><span class="p">,</span> <span class="n">imag</span><span class="p">)</span>
</span><span id="ComplexTensor-245"><a href="#ComplexTensor-245"><span class="linenos">245</span></a>		
</span><span id="ComplexTensor-246"><a href="#ComplexTensor-246"><span class="linenos">246</span></a>	<span class="k">def</span><span class="w"> </span><span class="fm">__rmatmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="ComplexTensor-247"><a href="#ComplexTensor-247"><span class="linenos">247</span></a>		<span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="ComplexTensor-248"><a href="#ComplexTensor-248"><span class="linenos">248</span></a>		
</span><span id="ComplexTensor-249"><a href="#ComplexTensor-249"><span class="linenos">249</span></a>	<span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="ComplexTensor-250"><a href="#ComplexTensor-250"><span class="linenos">250</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tg_override</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A tensor class that can be used for operations that require complex numbers.
It stores the real and imaginary components as separate tinygrad tensors, but this
may change if another means of storage is found to be more optimal.</p>
</div>


                            <div id="ComplexTensor.__init__" class="classattr">
                                        <input id="ComplexTensor.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">ComplexTensor</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">real</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">tinygrad</span><span class="o">.</span><span class="n">tensor</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>,</span><span class="param">	<span class="n">imag</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">tinygrad</span><span class="o">.</span><span class="n">tensor</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">device</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="ComplexTensor.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ComplexTensor.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ComplexTensor.__init__-13"><a href="#ComplexTensor.__init__-13"><span class="linenos">13</span></a>	<span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="ComplexTensor.__init__-14"><a href="#ComplexTensor.__init__-14"><span class="linenos">14</span></a>				<span class="n">real</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
</span><span id="ComplexTensor.__init__-15"><a href="#ComplexTensor.__init__-15"><span class="linenos">15</span></a>				<span class="n">imag</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">device</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="ComplexTensor.__init__-16"><a href="#ComplexTensor.__init__-16"><span class="linenos">16</span></a>		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">real</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="ComplexTensor.__init__-17"><a href="#ComplexTensor.__init__-17"><span class="linenos">17</span></a>			<span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">iscomplexobj</span><span class="p">(</span><span class="n">real</span><span class="p">):</span>
</span><span id="ComplexTensor.__init__-18"><a href="#ComplexTensor.__init__-18"><span class="linenos">18</span></a>				<span class="n">real</span><span class="p">,</span> <span class="n">imag</span> <span class="o">=</span> <span class="n">real</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">real</span><span class="o">.</span><span class="n">imag</span>
</span><span id="ComplexTensor.__init__-19"><a href="#ComplexTensor.__init__-19"><span class="linenos">19</span></a>				<span class="n">imag</span> <span class="o">=</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">imag</span><span class="p">,</span> <span class="n">device</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
</span><span id="ComplexTensor.__init__-20"><a href="#ComplexTensor.__init__-20"><span class="linenos">20</span></a>			<span class="n">real</span> <span class="o">=</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">real</span><span class="p">,</span> <span class="n">device</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
</span><span id="ComplexTensor.__init__-21"><a href="#ComplexTensor.__init__-21"><span class="linenos">21</span></a>			<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">imag</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="ComplexTensor.__init__-22"><a href="#ComplexTensor.__init__-22"><span class="linenos">22</span></a>				<span class="n">imag</span> <span class="o">=</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">imag</span><span class="p">,</span> <span class="n">device</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
</span><span id="ComplexTensor.__init__-23"><a href="#ComplexTensor.__init__-23"><span class="linenos">23</span></a>		
</span><span id="ComplexTensor.__init__-24"><a href="#ComplexTensor.__init__-24"><span class="linenos">24</span></a>		<span class="k">if</span> <span class="n">imag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ComplexTensor.__init__-25"><a href="#ComplexTensor.__init__-25"><span class="linenos">25</span></a>			<span class="n">imag</span> <span class="o">=</span> <span class="n">real</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">()</span>
</span><span id="ComplexTensor.__init__-26"><a href="#ComplexTensor.__init__-26"><span class="linenos">26</span></a>		<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">real</span><span class="p">,</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected tinygrad.Tensor, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">real</span><span class="p">)</span><span class="si">}</span><span class="s2"> instead&quot;</span>
</span><span id="ComplexTensor.__init__-27"><a href="#ComplexTensor.__init__-27"><span class="linenos">27</span></a>		<span class="k">if</span> <span class="ow">not</span> <span class="n">device</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ComplexTensor.__init__-28"><a href="#ComplexTensor.__init__-28"><span class="linenos">28</span></a>			<span class="n">real</span> <span class="o">=</span> <span class="n">real</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="ComplexTensor.__init__-29"><a href="#ComplexTensor.__init__-29"><span class="linenos">29</span></a>			<span class="n">imag</span> <span class="o">=</span> <span class="n">imag</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="ComplexTensor.__init__-30"><a href="#ComplexTensor.__init__-30"><span class="linenos">30</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_real</span> <span class="o">=</span> <span class="n">real</span>
</span><span id="ComplexTensor.__init__-31"><a href="#ComplexTensor.__init__-31"><span class="linenos">31</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_imag</span> <span class="o">=</span> <span class="n">imag</span>
</span><span id="ComplexTensor.__init__-32"><a href="#ComplexTensor.__init__-32"><span class="linenos">32</span></a>		<span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_real</span><span class="o">.</span><span class="n">device</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imag</span><span class="o">.</span><span class="n">device</span>
</span></pre></div>


    

                            </div>
                            <div id="ComplexTensor.real" class="classattr">
                                        <input id="ComplexTensor.real-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">real</span><span class="annotation">: tinygrad.tensor.Tensor</span>

                <label class="view-source-button" for="ComplexTensor.real-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ComplexTensor.real"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ComplexTensor.real-34"><a href="#ComplexTensor.real-34"><span class="linenos">34</span></a>	<span class="nd">@property</span>
</span><span id="ComplexTensor.real-35"><a href="#ComplexTensor.real-35"><span class="linenos">35</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">real</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="ComplexTensor.real-36"><a href="#ComplexTensor.real-36"><span class="linenos">36</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ComplexTensor.real-37"><a href="#ComplexTensor.real-37"><span class="linenos">37</span></a><span class="sd">		The real component of the tensor</span>
</span><span id="ComplexTensor.real-38"><a href="#ComplexTensor.real-38"><span class="linenos">38</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="ComplexTensor.real-39"><a href="#ComplexTensor.real-39"><span class="linenos">39</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_real</span>
</span></pre></div>


            <div class="docstring"><p>The real component of the tensor</p>
</div>


                            </div>
                            <div id="ComplexTensor.imag" class="classattr">
                                        <input id="ComplexTensor.imag-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">imag</span><span class="annotation">: tinygrad.tensor.Tensor</span>

                <label class="view-source-button" for="ComplexTensor.imag-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ComplexTensor.imag"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ComplexTensor.imag-41"><a href="#ComplexTensor.imag-41"><span class="linenos">41</span></a>	<span class="nd">@property</span>
</span><span id="ComplexTensor.imag-42"><a href="#ComplexTensor.imag-42"><span class="linenos">42</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">imag</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="ComplexTensor.imag-43"><a href="#ComplexTensor.imag-43"><span class="linenos">43</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ComplexTensor.imag-44"><a href="#ComplexTensor.imag-44"><span class="linenos">44</span></a><span class="sd">		The imaginary component of the tensor</span>
</span><span id="ComplexTensor.imag-45"><a href="#ComplexTensor.imag-45"><span class="linenos">45</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="ComplexTensor.imag-46"><a href="#ComplexTensor.imag-46"><span class="linenos">46</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imag</span>
</span></pre></div>


            <div class="docstring"><p>The imaginary component of the tensor</p>
</div>


                            </div>
                            <div id="ComplexTensor.device" class="classattr">
                                        <input id="ComplexTensor.device-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">device</span><span class="annotation">: str</span>

                <label class="view-source-button" for="ComplexTensor.device-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ComplexTensor.device"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ComplexTensor.device-48"><a href="#ComplexTensor.device-48"><span class="linenos">48</span></a>	<span class="nd">@property</span>
</span><span id="ComplexTensor.device-49"><a href="#ComplexTensor.device-49"><span class="linenos">49</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">device</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ComplexTensor.device-50"><a href="#ComplexTensor.device-50"><span class="linenos">50</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ComplexTensor.device-51"><a href="#ComplexTensor.device-51"><span class="linenos">51</span></a><span class="sd">		The device that both the real and imaginary components are stored on.</span>
</span><span id="ComplexTensor.device-52"><a href="#ComplexTensor.device-52"><span class="linenos">52</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="ComplexTensor.device-53"><a href="#ComplexTensor.device-53"><span class="linenos">53</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_real</span><span class="o">.</span><span class="n">device</span>
</span></pre></div>


            <div class="docstring"><p>The device that both the real and imaginary components are stored on.</p>
</div>


                            </div>
                            <div id="ComplexTensor.ndim" class="classattr">
                                        <input id="ComplexTensor.ndim-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">ndim</span>

                <label class="view-source-button" for="ComplexTensor.ndim-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ComplexTensor.ndim"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ComplexTensor.ndim-55"><a href="#ComplexTensor.ndim-55"><span class="linenos">55</span></a>	<span class="nd">@property</span>
</span><span id="ComplexTensor.ndim-56"><a href="#ComplexTensor.ndim-56"><span class="linenos">56</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">ndim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ComplexTensor.ndim-57"><a href="#ComplexTensor.ndim-57"><span class="linenos">57</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_real</span><span class="o">.</span><span class="n">ndim</span>
</span></pre></div>


    

                            </div>
                            <div id="ComplexTensor.T" class="classattr">
                                        <input id="ComplexTensor.T-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">T</span>

                <label class="view-source-button" for="ComplexTensor.T-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ComplexTensor.T"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ComplexTensor.T-59"><a href="#ComplexTensor.T-59"><span class="linenos">59</span></a>	<span class="nd">@property</span>
</span><span id="ComplexTensor.T-60"><a href="#ComplexTensor.T-60"><span class="linenos">60</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">T</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ComplexTensor.T-61"><a href="#ComplexTensor.T-61"><span class="linenos">61</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ComplexTensor.T-62"><a href="#ComplexTensor.T-62"><span class="linenos">62</span></a><span class="sd">		See [tinygrad.Tensor.T](https://docs.tinygrad.org/tensor/properties/#tinygrad.Tensor.T)</span>
</span><span id="ComplexTensor.T-63"><a href="#ComplexTensor.T-63"><span class="linenos">63</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="ComplexTensor.T-64"><a href="#ComplexTensor.T-64"><span class="linenos">64</span></a>		<span class="k">return</span> <span class="n">ComplexTensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_real</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imag</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>See <a href="https://docs.tinygrad.org/tensor/properties/#tinygrad.Tensor.T">tinygrad.Tensor.T</a></p>
</div>


                            </div>
                            <div id="ComplexTensor.shape" class="classattr">
                                        <input id="ComplexTensor.shape-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">shape</span>

                <label class="view-source-button" for="ComplexTensor.shape-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ComplexTensor.shape"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ComplexTensor.shape-66"><a href="#ComplexTensor.shape-66"><span class="linenos">66</span></a>	<span class="nd">@property</span>
</span><span id="ComplexTensor.shape-67"><a href="#ComplexTensor.shape-67"><span class="linenos">67</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ComplexTensor.shape-68"><a href="#ComplexTensor.shape-68"><span class="linenos">68</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ComplexTensor.shape-69"><a href="#ComplexTensor.shape-69"><span class="linenos">69</span></a><span class="sd">		See [tinygrad.Tensor.shape](https://docs.tinygrad.org/tensor/properties/#tinygrad.Tensor.shape)</span>
</span><span id="ComplexTensor.shape-70"><a href="#ComplexTensor.shape-70"><span class="linenos">70</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="ComplexTensor.shape-71"><a href="#ComplexTensor.shape-71"><span class="linenos">71</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_real</span><span class="o">.</span><span class="n">shape</span>
</span></pre></div>


            <div class="docstring"><p>See <a href="https://docs.tinygrad.org/tensor/properties/#tinygrad.Tensor.shape">tinygrad.Tensor.shape</a></p>
</div>


                            </div>
                            <div id="ComplexTensor.dtype" class="classattr">
                                        <input id="ComplexTensor.dtype-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">dtype</span>

                <label class="view-source-button" for="ComplexTensor.dtype-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ComplexTensor.dtype"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ComplexTensor.dtype-73"><a href="#ComplexTensor.dtype-73"><span class="linenos">73</span></a>	<span class="nd">@property</span>
</span><span id="ComplexTensor.dtype-74"><a href="#ComplexTensor.dtype-74"><span class="linenos">74</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ComplexTensor.dtype-75"><a href="#ComplexTensor.dtype-75"><span class="linenos">75</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ComplexTensor.dtype-76"><a href="#ComplexTensor.dtype-76"><span class="linenos">76</span></a><span class="sd">		Unlike numpy or pytorch, tinygrad does not have complex64 and complex128 dtypes.</span>
</span><span id="ComplexTensor.dtype-77"><a href="#ComplexTensor.dtype-77"><span class="linenos">77</span></a><span class="sd">		Because of this, the underlying tinygrad dtype of the real component is returned instead.</span>
</span><span id="ComplexTensor.dtype-78"><a href="#ComplexTensor.dtype-78"><span class="linenos">78</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="ComplexTensor.dtype-79"><a href="#ComplexTensor.dtype-79"><span class="linenos">79</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_real</span><span class="o">.</span><span class="n">dtype</span>
</span></pre></div>


            <div class="docstring"><p>Unlike numpy or pytorch, tinygrad does not have complex64 and complex128 dtypes.
Because of this, the underlying tinygrad dtype of the real component is returned instead.</p>
</div>


                            </div>
                            <div id="ComplexTensor.to" class="classattr">
                                        <input id="ComplexTensor.to-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">to</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ComplexTensor.to-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ComplexTensor.to"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ComplexTensor.to-81"><a href="#ComplexTensor.to-81"><span class="linenos">81</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="ComplexTensor.to-82"><a href="#ComplexTensor.to-82"><span class="linenos">82</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ComplexTensor.to-83"><a href="#ComplexTensor.to-83"><span class="linenos">83</span></a><span class="sd">		See [tinygrad.Tensor.to()](https://docs.tinygrad.org/tensor/properties/#tinygrad.Tensor.to)</span>
</span><span id="ComplexTensor.to-84"><a href="#ComplexTensor.to-84"><span class="linenos">84</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="ComplexTensor.to-85"><a href="#ComplexTensor.to-85"><span class="linenos">85</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tg_override</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>See <a href="https://docs.tinygrad.org/tensor/properties/#tinygrad.Tensor.to">tinygrad.Tensor.to()</a></p>
</div>


                            </div>
                            <div id="ComplexTensor.to_" class="classattr">
                                        <input id="ComplexTensor.to_-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">to_</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">device</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ComplexTensor.to_-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ComplexTensor.to_"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ComplexTensor.to_-87"><a href="#ComplexTensor.to_-87"><span class="linenos">87</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">to_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
</span><span id="ComplexTensor.to_-88"><a href="#ComplexTensor.to_-88"><span class="linenos">88</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ComplexTensor.to_-89"><a href="#ComplexTensor.to_-89"><span class="linenos">89</span></a><span class="sd">		See [tinygrad.Tensor.to_()](https://docs.tinygrad.org/tensor/properties/#tinygrad.Tensor.to_)</span>
</span><span id="ComplexTensor.to_-90"><a href="#ComplexTensor.to_-90"><span class="linenos">90</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="ComplexTensor.to_-91"><a href="#ComplexTensor.to_-91"><span class="linenos">91</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_real</span><span class="o">.</span><span class="n">to_</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="ComplexTensor.to_-92"><a href="#ComplexTensor.to_-92"><span class="linenos">92</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_imag</span><span class="o">.</span><span class="n">to_</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="ComplexTensor.to_-93"><a href="#ComplexTensor.to_-93"><span class="linenos">93</span></a>		<span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


            <div class="docstring"><p>See <a href="https://docs.tinygrad.org/tensor/properties/#tinygrad.Tensor.to_">tinygrad.Tensor.to_()</a></p>
</div>


                            </div>
                            <div id="ComplexTensor.cast" class="classattr">
                                        <input id="ComplexTensor.cast-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">cast</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ComplexTensor.cast-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ComplexTensor.cast"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ComplexTensor.cast-95"><a href="#ComplexTensor.cast-95"><span class="linenos">95</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">cast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="ComplexTensor.cast-96"><a href="#ComplexTensor.cast-96"><span class="linenos">96</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ComplexTensor.cast-97"><a href="#ComplexTensor.cast-97"><span class="linenos">97</span></a><span class="sd">		See [tinygrad.Tensor.cast()](https://docs.tinygrad.org/tensor/properties/#tinygrad.Tensor.cast)</span>
</span><span id="ComplexTensor.cast-98"><a href="#ComplexTensor.cast-98"><span class="linenos">98</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="ComplexTensor.cast-99"><a href="#ComplexTensor.cast-99"><span class="linenos">99</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tg_override</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>See <a href="https://docs.tinygrad.org/tensor/properties/#tinygrad.Tensor.cast">tinygrad.Tensor.cast()</a></p>
</div>


                            </div>
                            <div id="ComplexTensor.numel" class="classattr">
                                        <input id="ComplexTensor.numel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">numel</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ComplexTensor.numel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ComplexTensor.numel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ComplexTensor.numel-101"><a href="#ComplexTensor.numel-101"><span class="linenos">101</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">numel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ComplexTensor.numel-102"><a href="#ComplexTensor.numel-102"><span class="linenos">102</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ComplexTensor.numel-103"><a href="#ComplexTensor.numel-103"><span class="linenos">103</span></a><span class="sd">		See [tinygrad.Tensor.numel()](https://docs.tinygrad.org/tensor/properties/#tinygrad.Tensor.numel)</span>
</span><span id="ComplexTensor.numel-104"><a href="#ComplexTensor.numel-104"><span class="linenos">104</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="ComplexTensor.numel-105"><a href="#ComplexTensor.numel-105"><span class="linenos">105</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_real</span><span class="o">.</span><span class="n">numel</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>See <a href="https://docs.tinygrad.org/tensor/properties/#tinygrad.Tensor.numel">tinygrad.Tensor.numel()</a></p>
</div>


                            </div>
                            <div id="ComplexTensor.replace" class="classattr">
                                        <input id="ComplexTensor.replace-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">replace</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">new</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ComplexTensor.replace-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ComplexTensor.replace"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ComplexTensor.replace-107"><a href="#ComplexTensor.replace-107"><span class="linenos">107</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new</span><span class="p">):</span>
</span><span id="ComplexTensor.replace-108"><a href="#ComplexTensor.replace-108"><span class="linenos">108</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ComplexTensor.replace-109"><a href="#ComplexTensor.replace-109"><span class="linenos">109</span></a><span class="sd">		Replace this tensor with another.</span>
</span><span id="ComplexTensor.replace-110"><a href="#ComplexTensor.replace-110"><span class="linenos">110</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="ComplexTensor.replace-111"><a href="#ComplexTensor.replace-111"><span class="linenos">111</span></a>		<span class="c1"># lets be picky about it for now</span>
</span><span id="ComplexTensor.replace-112"><a href="#ComplexTensor.replace-112"><span class="linenos">112</span></a>		<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">ComplexTensor</span><span class="p">)</span>
</span><span id="ComplexTensor.replace-113"><a href="#ComplexTensor.replace-113"><span class="linenos">113</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_real</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
</span><span id="ComplexTensor.replace-114"><a href="#ComplexTensor.replace-114"><span class="linenos">114</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_imag</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
</span><span id="ComplexTensor.replace-115"><a href="#ComplexTensor.replace-115"><span class="linenos">115</span></a>		<span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


            <div class="docstring"><p>Replace this tensor with another.</p>
</div>


                            </div>
                            <div id="ComplexTensor.contiguous" class="classattr">
                                        <input id="ComplexTensor.contiguous-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">contiguous</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ComplexTensor.contiguous-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ComplexTensor.contiguous"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ComplexTensor.contiguous-146"><a href="#ComplexTensor.contiguous-146"><span class="linenos">146</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">contiguous</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ComplexTensor.contiguous-147"><a href="#ComplexTensor.contiguous-147"><span class="linenos">147</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tg_override</span><span class="p">()</span>
</span></pre></div>


    

                            </div>
                            <div id="ComplexTensor.realize" class="classattr">
                                        <input id="ComplexTensor.realize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">realize</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ComplexTensor.realize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ComplexTensor.realize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ComplexTensor.realize-149"><a href="#ComplexTensor.realize-149"><span class="linenos">149</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">realize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ComplexTensor.realize-150"><a href="#ComplexTensor.realize-150"><span class="linenos">150</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tg_override</span><span class="p">()</span>
</span></pre></div>


    

                            </div>
                            <div id="ComplexTensor.reshape" class="classattr">
                                        <input id="ComplexTensor.reshape-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reshape</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ComplexTensor.reshape-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ComplexTensor.reshape"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ComplexTensor.reshape-152"><a href="#ComplexTensor.reshape-152"><span class="linenos">152</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">reshape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="ComplexTensor.reshape-153"><a href="#ComplexTensor.reshape-153"><span class="linenos">153</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tg_override</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="ComplexTensor.numpy" class="classattr">
                                        <input id="ComplexTensor.numpy-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">numpy</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ComplexTensor.numpy-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ComplexTensor.numpy"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ComplexTensor.numpy-155"><a href="#ComplexTensor.numpy-155"><span class="linenos">155</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">numpy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ComplexTensor.numpy-156"><a href="#ComplexTensor.numpy-156"><span class="linenos">156</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ComplexTensor.numpy-157"><a href="#ComplexTensor.numpy-157"><span class="linenos">157</span></a><span class="sd">		See [tinygrad.Tensor.numpy()](https://docs.tinygrad.org/tensor/properties/#tinygrad.Tensor.numpy)</span>
</span><span id="ComplexTensor.numpy-158"><a href="#ComplexTensor.numpy-158"><span class="linenos">158</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="ComplexTensor.numpy-159"><a href="#ComplexTensor.numpy-159"><span class="linenos">159</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">real</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">imag</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span> <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>See <a href="https://docs.tinygrad.org/tensor/properties/#tinygrad.Tensor.numpy">tinygrad.Tensor.numpy()</a></p>
</div>


                            </div>
                </section>
                <section id="diag">
                            <input id="diag-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">diag</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">t</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="diag-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#diag"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="diag-27"><a href="#diag-27"><span class="linenos">27</span></a><span class="k">def</span><span class="w"> </span><span class="nf">diag</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="diag-28"><a href="#diag-28"><span class="linenos">28</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="diag-29"><a href="#diag-29"><span class="linenos">29</span></a><span class="sd">	See [torch.diag](https://docs.pytorch.org/docs/stable/generated/torch.diag.html)</span>
</span><span id="diag-30"><a href="#diag-30"><span class="linenos">30</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="diag-31"><a href="#diag-31"><span class="linenos">31</span></a>	<span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="diag-32"><a href="#diag-32"><span class="linenos">32</span></a>	<span class="k">if</span> <span class="s2">&quot;diagonal&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="diag-33"><a href="#diag-33"><span class="linenos">33</span></a>		<span class="n">offset</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;diagonal&quot;</span><span class="p">]</span>
</span><span id="diag-34"><a href="#diag-34"><span class="linenos">34</span></a>	<span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="diag-35"><a href="#diag-35"><span class="linenos">35</span></a>		<span class="n">offset</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="diag-36"><a href="#diag-36"><span class="linenos">36</span></a>	<span class="n">t_original</span> <span class="o">=</span> <span class="n">t</span>
</span><span id="diag-37"><a href="#diag-37"><span class="linenos">37</span></a>	<span class="n">t</span> <span class="o">=</span> <span class="n">_slice_to_square</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
</span><span id="diag-38"><a href="#diag-38"><span class="linenos">38</span></a>	<span class="n">e</span> <span class="o">=</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="diag-39"><a href="#diag-39"><span class="linenos">39</span></a>	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="diag-40"><a href="#diag-40"><span class="linenos">40</span></a>		<span class="c1"># make diagonal matrix from 1-D tensor</span>
</span><span id="diag-41"><a href="#diag-41"><span class="linenos">41</span></a>		<span class="n">out</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span> <span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">)</span> <span class="o">*</span> <span class="n">e</span>
</span><span id="diag-42"><a href="#diag-42"><span class="linenos">42</span></a>		<span class="k">if</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="diag-43"><a href="#diag-43"><span class="linenos">43</span></a>			<span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">offset</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">offset</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span> <span class="p">)</span>
</span><span id="diag-44"><a href="#diag-44"><span class="linenos">44</span></a>		<span class="k">elif</span> <span class="n">offset</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="diag-45"><a href="#diag-45"><span class="linenos">45</span></a>			<span class="c1"># pad</span>
</span><span id="diag-46"><a href="#diag-46"><span class="linenos">46</span></a>			<span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span> <span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span> <span class="p">)</span>
</span><span id="diag-47"><a href="#diag-47"><span class="linenos">47</span></a>		<span class="k">return</span> <span class="n">out</span>
</span><span id="diag-48"><a href="#diag-48"><span class="linenos">48</span></a>	<span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="diag-49"><a href="#diag-49"><span class="linenos">49</span></a>		<span class="c1"># make 1-D array from 2-D tensor</span>
</span><span id="diag-50"><a href="#diag-50"><span class="linenos">50</span></a>		<span class="n">out</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span><span class="o">*</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">keepdim</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
</span><span id="diag-51"><a href="#diag-51"><span class="linenos">51</span></a>		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="diag-52"><a href="#diag-52"><span class="linenos">52</span></a>			<span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="diag-53"><a href="#diag-53"><span class="linenos">53</span></a>		<span class="k">return</span> <span class="n">out</span>
</span><span id="diag-54"><a href="#diag-54"><span class="linenos">54</span></a>	<span class="k">else</span><span class="p">:</span>
</span><span id="diag-55"><a href="#diag-55"><span class="linenos">55</span></a>		<span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected 2D or 1D tensor, but got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="w"> </span><span class="si">}</span><span class="s2">D instead.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>See <a href="https://docs.pytorch.org/docs/stable/generated/torch.diag.html">torch.diag</a></p>
</div>


                </section>
                <section id="is_tinygrad_module">
                            <input id="is_tinygrad_module-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_tinygrad_module</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">obj</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="is_tinygrad_module-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#is_tinygrad_module"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="is_tinygrad_module-74"><a href="#is_tinygrad_module-74"><span class="linenos">74</span></a><span class="k">def</span><span class="w"> </span><span class="nf">is_tinygrad_module</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
</span><span id="is_tinygrad_module-75"><a href="#is_tinygrad_module-75"><span class="linenos">75</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="is_tinygrad_module-76"><a href="#is_tinygrad_module-76"><span class="linenos">76</span></a><span class="sd">	Utility method for checking if an object contains tinygrad tensors.</span>
</span><span id="is_tinygrad_module-77"><a href="#is_tinygrad_module-77"><span class="linenos">77</span></a><span class="sd">	</span>
</span><span id="is_tinygrad_module-78"><a href="#is_tinygrad_module-78"><span class="linenos">78</span></a><span class="sd">	Returns True if yes, False if no.</span>
</span><span id="is_tinygrad_module-79"><a href="#is_tinygrad_module-79"><span class="linenos">79</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="is_tinygrad_module-80"><a href="#is_tinygrad_module-80"><span class="linenos">80</span></a>	<span class="c1"># here we check if the object has any tinygrad tensors</span>
</span><span id="is_tinygrad_module-81"><a href="#is_tinygrad_module-81"><span class="linenos">81</span></a>	<span class="n">state_dict</span> <span class="o">=</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">get_state_dict</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span id="is_tinygrad_module-82"><a href="#is_tinygrad_module-82"><span class="linenos">82</span></a>	<span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">state_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span></pre></div>


            <div class="docstring"><p>Utility method for checking if an object contains tinygrad tensors.</p>

<p>Returns True if yes, False if no.</p>
</div>


                </section>
                <section id="module_on_device">
                            <input id="module_on_device-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">module_on_device</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">obj</span>, </span><span class="param"><span class="n">device</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="module_on_device-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#module_on_device"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="module_on_device-84"><a href="#module_on_device-84"><span class="linenos">84</span></a><span class="k">def</span><span class="w"> </span><span class="nf">module_on_device</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="module_on_device-85"><a href="#module_on_device-85"><span class="linenos">85</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="module_on_device-86"><a href="#module_on_device-86"><span class="linenos">86</span></a><span class="sd">	Returns True if all tinygrad.Tensor members of obj are on device, False if otherwise</span>
</span><span id="module_on_device-87"><a href="#module_on_device-87"><span class="linenos">87</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="module_on_device-88"><a href="#module_on_device-88"><span class="linenos">88</span></a>	<span class="c1"># TODO: canonicalize device</span>
</span><span id="module_on_device-89"><a href="#module_on_device-89"><span class="linenos">89</span></a>	<span class="n">state_dict</span> <span class="o">=</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">get_state_dict</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span id="module_on_device-90"><a href="#module_on_device-90"><span class="linenos">90</span></a>	<span class="k">assert</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">state_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Not a tinygrad module&quot;</span>
</span><span id="module_on_device-91"><a href="#module_on_device-91"><span class="linenos">91</span></a>	<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">state_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="module_on_device-92"><a href="#module_on_device-92"><span class="linenos">92</span></a>		<span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="n">device</span> <span class="o">==</span> <span class="n">device</span><span class="p">:</span>
</span><span id="module_on_device-93"><a href="#module_on_device-93"><span class="linenos">93</span></a>			<span class="k">return</span> <span class="kc">False</span>
</span><span id="module_on_device-94"><a href="#module_on_device-94"><span class="linenos">94</span></a>	<span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Returns True if all tinygrad.Tensor members of obj are on device, False if otherwise</p>
</div>


                </section>
                <section id="move_to_device">
                            <input id="move_to_device-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">move_to_device</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">obj</span>, </span><span class="param"><span class="n">device</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">safe</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="move_to_device-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#move_to_device"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="move_to_device-96"><a href="#move_to_device-96"><span class="linenos"> 96</span></a><span class="k">def</span><span class="w"> </span><span class="nf">move_to_device</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">safe</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="move_to_device-97"><a href="#move_to_device-97"><span class="linenos"> 97</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="move_to_device-98"><a href="#move_to_device-98"><span class="linenos"> 98</span></a><span class="sd">	Moves all tinygrad.Tensor instance members in an obj to device</span>
</span><span id="move_to_device-99"><a href="#move_to_device-99"><span class="linenos"> 99</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="move_to_device-100"><a href="#move_to_device-100"><span class="linenos">100</span></a>	<span class="k">if</span> <span class="n">safe</span><span class="p">:</span>
</span><span id="move_to_device-101"><a href="#move_to_device-101"><span class="linenos">101</span></a>		<span class="c1"># now that should be inplace</span>
</span><span id="move_to_device-102"><a href="#move_to_device-102"><span class="linenos">102</span></a>		<span class="k">return</span> <span class="n">cast_to_supported_and_move_</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>
</span><span id="move_to_device-103"><a href="#move_to_device-103"><span class="linenos">103</span></a>	<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">get_state_dict</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="move_to_device-104"><a href="#move_to_device-104"><span class="linenos">104</span></a>		<span class="n">v</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span> <span class="p">)</span>
</span><span id="move_to_device-105"><a href="#move_to_device-105"><span class="linenos">105</span></a>	<span class="k">return</span> <span class="n">obj</span>
</span></pre></div>


            <div class="docstring"><p>Moves all tinygrad.Tensor instance members in an obj to device</p>
</div>


                </section>
                <section id="cast_to_dtype">
                            <input id="cast_to_dtype-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">cast_to_dtype</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">obj</span>, </span><span class="param"><span class="n">dtype</span><span class="p">:</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">DType</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="cast_to_dtype-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#cast_to_dtype"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="cast_to_dtype-107"><a href="#cast_to_dtype-107"><span class="linenos">107</span></a><span class="k">def</span><span class="w"> </span><span class="nf">cast_to_dtype</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">DType</span><span class="p">):</span>
</span><span id="cast_to_dtype-108"><a href="#cast_to_dtype-108"><span class="linenos">108</span></a>	<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">get_state_dict</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="cast_to_dtype-109"><a href="#cast_to_dtype-109"><span class="linenos">109</span></a>		<span class="n">v</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span> <span class="p">)</span>
</span><span id="cast_to_dtype-110"><a href="#cast_to_dtype-110"><span class="linenos">110</span></a>	<span class="k">return</span> <span class="n">obj</span>
</span></pre></div>


    

                </section>
                <section id="nonzero">
                            <input id="nonzero-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">nonzero</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">inp</span>, </span><span class="param"><span class="n">as_tuple</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="nonzero-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#nonzero"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="nonzero-234"><a href="#nonzero-234"><span class="linenos">234</span></a><span class="k">def</span><span class="w"> </span><span class="nf">nonzero</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">as_tuple</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="nonzero-235"><a href="#nonzero-235"><span class="linenos">235</span></a>	<span class="c1"># It is going to be very difficult to write this function</span>
</span><span id="nonzero-236"><a href="#nonzero-236"><span class="linenos">236</span></a>	<span class="c1"># in a manner that is JIT-compatible :c</span>
</span><span id="nonzero-237"><a href="#nonzero-237"><span class="linenos">237</span></a>	<span class="c1"># since the shapes can be variable-length :c</span>
</span><span id="nonzero-238"><a href="#nonzero-238"><span class="linenos">238</span></a>	<span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">inp</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span> <span class="p">)</span>
</span><span id="nonzero-239"><a href="#nonzero-239"><span class="linenos">239</span></a>	<span class="k">if</span> <span class="n">as_tuple</span><span class="p">:</span>
</span><span id="nonzero-240"><a href="#nonzero-240"><span class="linenos">240</span></a>		<span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="nonzero-241"><a href="#nonzero-241"><span class="linenos">241</span></a>	<span class="n">out_to_cat</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="nonzero-242"><a href="#nonzero-242"><span class="linenos">242</span></a>	<span class="k">for</span> <span class="n">idx_a</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
</span><span id="nonzero-243"><a href="#nonzero-243"><span class="linenos">243</span></a>		<span class="n">out_to_cat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx_a</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
</span><span id="nonzero-244"><a href="#nonzero-244"><span class="linenos">244</span></a>	<span class="k">return</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">out_to_cat</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">),</span> <span class="n">device</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span></pre></div>


    

                </section>
                <section id="cat">
                            <input id="cat-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">cat</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">tensors</span>, </span><span class="param"><span class="n">dim</span><span class="o">=</span><span class="mi">0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="cat-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#cat"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="cat-247"><a href="#cat-247"><span class="linenos">247</span></a><span class="k">def</span><span class="w"> </span><span class="nf">cat</span><span class="p">(</span><span class="n">tensors</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="cat-248"><a href="#cat-248"><span class="linenos">248</span></a>	<span class="c1"># is this even necessary??</span>
</span><span id="cat-249"><a href="#cat-249"><span class="linenos">249</span></a>	<span class="n">tbase</span> <span class="o">=</span> <span class="n">tensors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="cat-250"><a href="#cat-250"><span class="linenos">250</span></a>	<span class="n">trest</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">tensors</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="cat-251"><a href="#cat-251"><span class="linenos">251</span></a>	<span class="n">assert_same_device</span><span class="p">(</span><span class="n">tbase</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">trest</span><span class="p">)</span>
</span><span id="cat-252"><a href="#cat-252"><span class="linenos">252</span></a>	<span class="k">return</span> <span class="n">tbase</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="o">*</span><span class="n">trest</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span><span class="p">)</span>
</span></pre></div>


    

                </section>
                <section id="cumprod">
                            <input id="cumprod-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">cumprod</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">inp</span>, </span><span class="param"><span class="n">dim</span>, </span><span class="param"><span class="n">dtype</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">out</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="cumprod-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#cumprod"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="cumprod-254"><a href="#cumprod-254"><span class="linenos">254</span></a><span class="k">def</span><span class="w"> </span><span class="nf">cumprod</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="cumprod-255"><a href="#cumprod-255"><span class="linenos">255</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="cumprod-256"><a href="#cumprod-256"><span class="linenos">256</span></a><span class="sd">	See [torch.cumprod](https://docs.pytorch.org/docs/stable/generated/torch.cumprod.html)</span>
</span><span id="cumprod-257"><a href="#cumprod-257"><span class="linenos">257</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="cumprod-258"><a href="#cumprod-258"><span class="linenos">258</span></a>	<span class="c1"># first, get the slices used in the __getitem__ call for each element</span>
</span><span id="cumprod-259"><a href="#cumprod-259"><span class="linenos">259</span></a>	<span class="n">slices</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="cumprod-260"><a href="#cumprod-260"><span class="linenos">260</span></a>	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="o">.</span><span class="n">shape</span><span class="p">)):</span>
</span><span id="cumprod-261"><a href="#cumprod-261"><span class="linenos">261</span></a>		<span class="n">slices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="p">)</span>
</span><span id="cumprod-262"><a href="#cumprod-262"><span class="linenos">262</span></a>	
</span><span id="cumprod-263"><a href="#cumprod-263"><span class="linenos">263</span></a>	<span class="n">outputs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="cumprod-264"><a href="#cumprod-264"><span class="linenos">264</span></a>	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">inp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="p">):</span>
</span><span id="cumprod-265"><a href="#cumprod-265"><span class="linenos">265</span></a>		<span class="n">slices</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="cumprod-266"><a href="#cumprod-266"><span class="linenos">266</span></a>		<span class="n">new_shape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">inp</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="cumprod-267"><a href="#cumprod-267"><span class="linenos">267</span></a>		<span class="n">new_shape</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="cumprod-268"><a href="#cumprod-268"><span class="linenos">268</span></a>		<span class="n">new_shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">new_shape</span><span class="p">)</span>
</span><span id="cumprod-269"><a href="#cumprod-269"><span class="linenos">269</span></a>		<span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inp</span><span class="p">[</span><span class="n">slices</span><span class="p">]</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">new_shape</span><span class="p">)</span> <span class="p">)</span>
</span><span id="cumprod-270"><a href="#cumprod-270"><span class="linenos">270</span></a>	<span class="k">return</span> <span class="n">cat</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>See <a href="https://docs.pytorch.org/docs/stable/generated/torch.cumprod.html">torch.cumprod</a></p>
</div>


                </section>
                <section id="assert_same_device">
                            <input id="assert_same_device-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">assert_same_device</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">dev</span>, </span><span class="param"><span class="o">*</span><span class="n">inp</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="assert_same_device-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#assert_same_device"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="assert_same_device-272"><a href="#assert_same_device-272"><span class="linenos">272</span></a><span class="k">def</span><span class="w"> </span><span class="nf">assert_same_device</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="o">*</span><span class="n">inp</span><span class="p">):</span>
</span><span id="assert_same_device-273"><a href="#assert_same_device-273"><span class="linenos">273</span></a>	<span class="n">dev</span> <span class="o">=</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">Device</span><span class="o">.</span><span class="n">canonicalize</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span>
</span><span id="assert_same_device-274"><a href="#assert_same_device-274"><span class="linenos">274</span></a>	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="assert_same_device-275"><a href="#assert_same_device-275"><span class="linenos">275</span></a>		<span class="n">inp</span> <span class="o">=</span> <span class="n">inp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="assert_same_device-276"><a href="#assert_same_device-276"><span class="linenos">276</span></a>	<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="s2">&quot;tg&quot;</span><span class="p">):</span>
</span><span id="assert_same_device-277"><a href="#assert_same_device-277"><span class="linenos">277</span></a>		<span class="k">assert</span> <span class="n">dev</span> <span class="o">==</span> <span class="n">inp</span><span class="o">.</span><span class="n">tg</span><span class="o">.</span><span class="n">device</span>
</span><span id="assert_same_device-278"><a href="#assert_same_device-278"><span class="linenos">278</span></a>	<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
</span><span id="assert_same_device-279"><a href="#assert_same_device-279"><span class="linenos">279</span></a>		<span class="k">assert</span> <span class="n">dev</span> <span class="o">==</span> <span class="n">inp</span><span class="o">.</span><span class="n">device</span>
</span><span id="assert_same_device-280"><a href="#assert_same_device-280"><span class="linenos">280</span></a>	<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="assert_same_device-281"><a href="#assert_same_device-281"><span class="linenos">281</span></a>		<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">inp</span><span class="p">:</span>
</span><span id="assert_same_device-282"><a href="#assert_same_device-282"><span class="linenos">282</span></a>			<span class="n">assert_same_device</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
</span><span id="assert_same_device-283"><a href="#assert_same_device-283"><span class="linenos">283</span></a>	<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="assert_same_device-284"><a href="#assert_same_device-284"><span class="linenos">284</span></a>		<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">inp</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="assert_same_device-285"><a href="#assert_same_device-285"><span class="linenos">285</span></a>			<span class="n">assert_same_device</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span><span id="assert_same_device-286"><a href="#assert_same_device-286"><span class="linenos">286</span></a>		<span class="k">return</span> <span class="n">inp</span>
</span><span id="assert_same_device-287"><a href="#assert_same_device-287"><span class="linenos">287</span></a>	<span class="k">else</span><span class="p">:</span>
</span><span id="assert_same_device-288"><a href="#assert_same_device-288"><span class="linenos">288</span></a>		<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="s2">&quot;__dict__&quot;</span><span class="p">):</span>
</span><span id="assert_same_device-289"><a href="#assert_same_device-289"><span class="linenos">289</span></a>			<span class="c1"># treat as dictionary hehe</span>
</span><span id="assert_same_device-290"><a href="#assert_same_device-290"><span class="linenos">290</span></a>			<span class="n">assert_same_device</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">inp</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
</span></pre></div>


    

                </section>
                <section id="chunk">
                            <input id="chunk-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">chunk</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">inp</span>, </span><span class="param"><span class="n">chunks</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="chunk-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#chunk"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="chunk-292"><a href="#chunk-292"><span class="linenos">292</span></a><span class="k">def</span><span class="w"> </span><span class="nf">chunk</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">chunks</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="chunk-293"><a href="#chunk-293"><span class="linenos">293</span></a>	<span class="k">return</span> <span class="n">inp</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
</span></pre></div>


    

                </section>
                <section id="clamp">
                            <input id="clamp-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">clamp</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">inp</span>, </span><span class="param"><span class="nb">min</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="nb">max</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="clamp-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#clamp"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="clamp-295"><a href="#clamp-295"><span class="linenos">295</span></a><span class="k">def</span><span class="w"> </span><span class="nf">clamp</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">max</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="clamp-296"><a href="#clamp-296"><span class="linenos">296</span></a>	<span class="k">return</span> <span class="n">inp</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">)</span>
</span></pre></div>


    

                </section>
                <section id="stack">
                            <input id="stack-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">stack</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">tensors</span>, </span><span class="param"><span class="n">dim</span><span class="o">=</span><span class="mi">0</span>, </span><span class="param"><span class="n">out</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="stack-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#stack"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="stack-298"><a href="#stack-298"><span class="linenos">298</span></a><span class="k">def</span><span class="w"> </span><span class="nf">stack</span><span class="p">(</span><span class="n">tensors</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">out</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="stack-299"><a href="#stack-299"><span class="linenos">299</span></a>	<span class="k">assert</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="stack-300"><a href="#stack-300"><span class="linenos">300</span></a>	<span class="n">tbase</span> <span class="o">=</span> <span class="n">tensors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="stack-301"><a href="#stack-301"><span class="linenos">301</span></a>	<span class="n">trest</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">tensors</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="stack-302"><a href="#stack-302"><span class="linenos">302</span></a>	<span class="n">assert_same_device</span><span class="p">(</span><span class="n">tbase</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">trest</span><span class="p">)</span>
</span><span id="stack-303"><a href="#stack-303"><span class="linenos">303</span></a>	<span class="k">return</span> <span class="n">tbase</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="o">*</span><span class="n">trest</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span><span class="p">)</span>
</span></pre></div>


    

                </section>
                <section id="outer">
                            <input id="outer-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">outer</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">u</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">tinygrad</span><span class="o">.</span><span class="n">tensor</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n"><a href="#ComplexTensor">ComplexTensor</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">v</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">tinygrad</span><span class="o">.</span><span class="n">tensor</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n"><a href="#ComplexTensor">ComplexTensor</a></span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="outer-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#outer"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="outer-305"><a href="#outer-305"><span class="linenos">305</span></a><span class="k">def</span><span class="w"> </span><span class="nf">outer</span><span class="p">(</span><span class="n">u</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">ComplexTensor</span><span class="p">],</span> <span class="n">v</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">ComplexTensor</span><span class="p">]):</span>
</span><span id="outer-306"><a href="#outer-306"><span class="linenos">306</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="outer-307"><a href="#outer-307"><span class="linenos">307</span></a><span class="sd">	Compute the outer product of two tensors.</span>
</span><span id="outer-308"><a href="#outer-308"><span class="linenos">308</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="outer-309"><a href="#outer-309"><span class="linenos">309</span></a>	<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Both supplied tensors must be 1D&quot;</span>
</span><span id="outer-310"><a href="#outer-310"><span class="linenos">310</span></a>	<span class="n">u_expanded</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="outer-311"><a href="#outer-311"><span class="linenos">311</span></a>	<span class="n">v_expanded</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="outer-312"><a href="#outer-312"><span class="linenos">312</span></a>	<span class="k">return</span> <span class="n">u_expanded</span> <span class="o">*</span> <span class="n">v_expanded</span>
</span></pre></div>


            <div class="docstring"><p>Compute the outer product of two tensors.</p>
</div>


                </section>
                <section id="limit_float_precision">
                            <input id="limit_float_precision-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">limit_float_precision</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">obj</span>,</span><span class="param">	<span class="n">low</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tinygrad</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">DType</span><span class="p">]</span>,</span><span class="param">	<span class="n">high</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tinygrad</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">DType</span><span class="p">]</span>,</span><span class="param">	<span class="n">new_device</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="limit_float_precision-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#limit_float_precision"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="limit_float_precision-174"><a href="#limit_float_precision-174"><span class="linenos">174</span></a><span class="k">def</span><span class="w"> </span><span class="nf">limit_float_precision</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span>
</span><span id="limit_float_precision-175"><a href="#limit_float_precision-175"><span class="linenos">175</span></a>			<span class="n">low</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">tinygrad</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">DType</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
</span><span id="limit_float_precision-176"><a href="#limit_float_precision-176"><span class="linenos">176</span></a>			<span class="n">high</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">tinygrad</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">DType</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
</span><span id="limit_float_precision-177"><a href="#limit_float_precision-177"><span class="linenos">177</span></a>			<span class="n">new_device</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="limit_float_precision-178"><a href="#limit_float_precision-178"><span class="linenos">178</span></a>		<span class="p">):</span>
</span><span id="limit_float_precision-179"><a href="#limit_float_precision-179"><span class="linenos">179</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="limit_float_precision-180"><a href="#limit_float_precision-180"><span class="linenos">180</span></a><span class="sd">	Limit the precision of a given module&#39;s float tensors.</span>
</span><span id="limit_float_precision-181"><a href="#limit_float_precision-181"><span class="linenos">181</span></a><span class="sd">	:param obj: The model/module/object with tinygrad tensors that this function will be applied to.</span>
</span><span id="limit_float_precision-182"><a href="#limit_float_precision-182"><span class="linenos">182</span></a><span class="sd">	:param low: The lowest-precision dtype to be allowed. If None is passed, the lowest precision float supported by the given device will be used.</span>
</span><span id="limit_float_precision-183"><a href="#limit_float_precision-183"><span class="linenos">183</span></a><span class="sd">	:param high: The highest-precision dtype to be allowed. If None is passed, the highest precision float supported by the given device will be used.</span>
</span><span id="limit_float_precision-184"><a href="#limit_float_precision-184"><span class="linenos">184</span></a><span class="sd">	:param new_device: The device that all the parameters will be moved to. If None is specified, their original device will be used.</span>
</span><span id="limit_float_precision-185"><a href="#limit_float_precision-185"><span class="linenos">185</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="limit_float_precision-186"><a href="#limit_float_precision-186"><span class="linenos">186</span></a>	<span class="k">return</span> <span class="n">_limit_dtype_group_precision</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="n">new_device</span><span class="p">,</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">floats</span><span class="p">,</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">is_float</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Limit the precision of a given module's float tensors.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>obj</strong>:  The model/module/object with tinygrad tensors that this function will be applied to.</li>
<li><strong>low</strong>:  The lowest-precision dtype to be allowed. If None is passed, the lowest precision float supported by the given device will be used.</li>
<li><strong>high</strong>:  The highest-precision dtype to be allowed. If None is passed, the highest precision float supported by the given device will be used.</li>
<li><strong>new_device</strong>:  The device that all the parameters will be moved to. If None is specified, their original device will be used.</li>
</ul>
</div>


                </section>
                <section id="limit_sint_precision">
                            <input id="limit_sint_precision-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">limit_sint_precision</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">obj</span>,</span><span class="param">	<span class="n">low</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tinygrad</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">DType</span><span class="p">]</span>,</span><span class="param">	<span class="n">high</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tinygrad</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">DType</span><span class="p">]</span>,</span><span class="param">	<span class="n">new_device</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="limit_sint_precision-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#limit_sint_precision"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="limit_sint_precision-188"><a href="#limit_sint_precision-188"><span class="linenos">188</span></a><span class="k">def</span><span class="w"> </span><span class="nf">limit_sint_precision</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span>
</span><span id="limit_sint_precision-189"><a href="#limit_sint_precision-189"><span class="linenos">189</span></a>			<span class="n">low</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">tinygrad</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">DType</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
</span><span id="limit_sint_precision-190"><a href="#limit_sint_precision-190"><span class="linenos">190</span></a>			<span class="n">high</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">tinygrad</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">DType</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
</span><span id="limit_sint_precision-191"><a href="#limit_sint_precision-191"><span class="linenos">191</span></a>			<span class="n">new_device</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="limit_sint_precision-192"><a href="#limit_sint_precision-192"><span class="linenos">192</span></a>		<span class="p">):</span>
</span><span id="limit_sint_precision-193"><a href="#limit_sint_precision-193"><span class="linenos">193</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="limit_sint_precision-194"><a href="#limit_sint_precision-194"><span class="linenos">194</span></a><span class="sd">	Limit the precision of a given module&#39;s signed integer tensors.</span>
</span><span id="limit_sint_precision-195"><a href="#limit_sint_precision-195"><span class="linenos">195</span></a><span class="sd">	:param obj: The model/module/object with tinygrad tensors that this function will be applied to.</span>
</span><span id="limit_sint_precision-196"><a href="#limit_sint_precision-196"><span class="linenos">196</span></a><span class="sd">	:param low: The lowest-precision dtype to be allowed. If None is passed, the lowest precision signed int supported by the given device will be used.</span>
</span><span id="limit_sint_precision-197"><a href="#limit_sint_precision-197"><span class="linenos">197</span></a><span class="sd">	:param high: The highest-precision dtype to be allowed. If None is passed, the highest precision signed int supported by the given device will be used.</span>
</span><span id="limit_sint_precision-198"><a href="#limit_sint_precision-198"><span class="linenos">198</span></a><span class="sd">	:param new_device: The device that all the parameters will be moved to. If None is specified, their original device will be used.</span>
</span><span id="limit_sint_precision-199"><a href="#limit_sint_precision-199"><span class="linenos">199</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="limit_sint_precision-200"><a href="#limit_sint_precision-200"><span class="linenos">200</span></a>	<span class="n">is_signed_int</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">is_int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">is_unsigned</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">)</span>
</span><span id="limit_sint_precision-201"><a href="#limit_sint_precision-201"><span class="linenos">201</span></a>	<span class="k">return</span> <span class="n">_limit_dtype_group_precision</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="n">new_device</span><span class="p">,</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">sints</span><span class="p">,</span> <span class="n">is_signed_int</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Limit the precision of a given module's signed integer tensors.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>obj</strong>:  The model/module/object with tinygrad tensors that this function will be applied to.</li>
<li><strong>low</strong>:  The lowest-precision dtype to be allowed. If None is passed, the lowest precision signed int supported by the given device will be used.</li>
<li><strong>high</strong>:  The highest-precision dtype to be allowed. If None is passed, the highest precision signed int supported by the given device will be used.</li>
<li><strong>new_device</strong>:  The device that all the parameters will be moved to. If None is specified, their original device will be used.</li>
</ul>
</div>


                </section>
                <section id="limit_uint_precision">
                            <input id="limit_uint_precision-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">limit_uint_precision</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">obj</span>,</span><span class="param">	<span class="n">low</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tinygrad</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">DType</span><span class="p">]</span>,</span><span class="param">	<span class="n">high</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tinygrad</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">DType</span><span class="p">]</span>,</span><span class="param">	<span class="n">new_device</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="limit_uint_precision-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#limit_uint_precision"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="limit_uint_precision-203"><a href="#limit_uint_precision-203"><span class="linenos">203</span></a><span class="k">def</span><span class="w"> </span><span class="nf">limit_uint_precision</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span>
</span><span id="limit_uint_precision-204"><a href="#limit_uint_precision-204"><span class="linenos">204</span></a>			<span class="n">low</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">tinygrad</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">DType</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
</span><span id="limit_uint_precision-205"><a href="#limit_uint_precision-205"><span class="linenos">205</span></a>			<span class="n">high</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">tinygrad</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">DType</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
</span><span id="limit_uint_precision-206"><a href="#limit_uint_precision-206"><span class="linenos">206</span></a>			<span class="n">new_device</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="limit_uint_precision-207"><a href="#limit_uint_precision-207"><span class="linenos">207</span></a>		<span class="p">):</span>
</span><span id="limit_uint_precision-208"><a href="#limit_uint_precision-208"><span class="linenos">208</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="limit_uint_precision-209"><a href="#limit_uint_precision-209"><span class="linenos">209</span></a><span class="sd">	Limit the precision of a given module&#39;s unsigned integer tensors.</span>
</span><span id="limit_uint_precision-210"><a href="#limit_uint_precision-210"><span class="linenos">210</span></a><span class="sd">	:param obj: The model/module/object with tinygrad tensors that this function will be applied to.</span>
</span><span id="limit_uint_precision-211"><a href="#limit_uint_precision-211"><span class="linenos">211</span></a><span class="sd">	:param low: The lowest-precision dtype to be allowed. If None is passed, the lowest precision unsigned int supported by the given device will be used.</span>
</span><span id="limit_uint_precision-212"><a href="#limit_uint_precision-212"><span class="linenos">212</span></a><span class="sd">	:param high: The highest-precision dtype to be allowed. If None is passed, the highest precision unsigned int supported by the given device will be used.</span>
</span><span id="limit_uint_precision-213"><a href="#limit_uint_precision-213"><span class="linenos">213</span></a><span class="sd">	:param new_device: The device that all the parameters will be moved to. If None is specified, their original device will be used.</span>
</span><span id="limit_uint_precision-214"><a href="#limit_uint_precision-214"><span class="linenos">214</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="limit_uint_precision-215"><a href="#limit_uint_precision-215"><span class="linenos">215</span></a>	<span class="n">is_unsigned_int</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">is_int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">is_unsigned</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="limit_uint_precision-216"><a href="#limit_uint_precision-216"><span class="linenos">216</span></a>	<span class="k">return</span> <span class="n">_limit_dtype_group_precision</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="n">new_device</span><span class="p">,</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">uints</span><span class="p">,</span> <span class="n">is_unsigned_int</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Limit the precision of a given module's unsigned integer tensors.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>obj</strong>:  The model/module/object with tinygrad tensors that this function will be applied to.</li>
<li><strong>low</strong>:  The lowest-precision dtype to be allowed. If None is passed, the lowest precision unsigned int supported by the given device will be used.</li>
<li><strong>high</strong>:  The highest-precision dtype to be allowed. If None is passed, the highest precision unsigned int supported by the given device will be used.</li>
<li><strong>new_device</strong>:  The device that all the parameters will be moved to. If None is specified, their original device will be used.</li>
</ul>
</div>


                </section>
                <section id="shard_model_">
                            <input id="shard_model_-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">shard_model_</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">model</span>, </span><span class="param"><span class="n">devices</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>, </span><span class="param"><span class="n">axis</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="shard_model_-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#shard_model_"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="shard_model_-314"><a href="#shard_model_-314"><span class="linenos">314</span></a><span class="k">def</span><span class="w"> </span><span class="nf">shard_model_</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">devices</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">axis</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="shard_model_-315"><a href="#shard_model_-315"><span class="linenos">315</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="shard_model_-316"><a href="#shard_model_-316"><span class="linenos">316</span></a><span class="sd">	Apply tinygrad.Tensor.shard_ to every tensor in a given model.</span>
</span><span id="shard_model_-317"><a href="#shard_model_-317"><span class="linenos">317</span></a><span class="sd">	:param model: The model whose tensors to apply shard_ to. Must have at least one tinygrad.Tensor member.</span>
</span><span id="shard_model_-318"><a href="#shard_model_-318"><span class="linenos">318</span></a><span class="sd">	:param devices: The devices to shard the model&#39;s tensors across.</span>
</span><span id="shard_model_-319"><a href="#shard_model_-319"><span class="linenos">319</span></a><span class="sd">	:param axis: The tensor axis on which to shard. If None, the parameters will be split across all GPUs</span>
</span><span id="shard_model_-320"><a href="#shard_model_-320"><span class="linenos">320</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="shard_model_-321"><a href="#shard_model_-321"><span class="linenos">321</span></a>	<span class="n">state_dict</span> <span class="o">=</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">get_state_dict</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</span><span id="shard_model_-322"><a href="#shard_model_-322"><span class="linenos">322</span></a>	<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">state_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;A valid model was not passed&quot;</span>
</span><span id="shard_model_-323"><a href="#shard_model_-323"><span class="linenos">323</span></a>	<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">state_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="shard_model_-324"><a href="#shard_model_-324"><span class="linenos">324</span></a>		<span class="n">v</span><span class="o">.</span><span class="n">shard_</span><span class="p">(</span><span class="n">devices</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="n">axis</span><span class="p">)</span>
</span><span id="shard_model_-325"><a href="#shard_model_-325"><span class="linenos">325</span></a>	<span class="k">return</span> <span class="n">model</span>
</span></pre></div>


            <div class="docstring"><p>Apply tinygrad.Tensor.shard_ to every tensor in a given model.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>model</strong>:  The model whose tensors to apply shard_ to. Must have at least one tinygrad.Tensor member.</li>
<li><strong>devices</strong>:  The devices to shard the model's tensors across.</li>
<li><strong>axis</strong>:  The tensor axis on which to shard. If None, the parameters will be split across all GPUs</li>
</ul>
</div>


                </section>
                <section id="cast_to_supported_and_move_">
                            <input id="cast_to_supported_and_move_-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">cast_to_supported_and_move_</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">obj</span>, </span><span class="param"><span class="n">new_device</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="cast_to_supported_and_move_-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#cast_to_supported_and_move_"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="cast_to_supported_and_move_-218"><a href="#cast_to_supported_and_move_-218"><span class="linenos">218</span></a><span class="k">def</span><span class="w"> </span><span class="nf">cast_to_supported_and_move_</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">new_device</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="cast_to_supported_and_move_-219"><a href="#cast_to_supported_and_move_-219"><span class="linenos">219</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="cast_to_supported_and_move_-220"><a href="#cast_to_supported_and_move_-220"><span class="linenos">220</span></a><span class="sd">	Cast all parameters/tensors of a model or tensor to dtypes supported by new_device, and </span>
</span><span id="cast_to_supported_and_move_-221"><a href="#cast_to_supported_and_move_-221"><span class="linenos">221</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="cast_to_supported_and_move_-222"><a href="#cast_to_supported_and_move_-222"><span class="linenos">222</span></a>	<span class="k">if</span> <span class="n">new_device</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="cast_to_supported_and_move_-223"><a href="#cast_to_supported_and_move_-223"><span class="linenos">223</span></a>		<span class="n">new_device</span> <span class="o">=</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">Device</span><span class="o">.</span><span class="n">DEFAULT</span>
</span><span id="cast_to_supported_and_move_-224"><a href="#cast_to_supported_and_move_-224"><span class="linenos">224</span></a>	<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_device</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="cast_to_supported_and_move_-225"><a href="#cast_to_supported_and_move_-225"><span class="linenos">225</span></a>		<span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="cast_to_supported_and_move_-226"><a href="#cast_to_supported_and_move_-226"><span class="linenos">226</span></a>	<span class="n">low_float</span><span class="p">,</span> <span class="n">high_float</span> <span class="o">=</span> <span class="n">compatibility</span><span class="o">.</span><span class="n">get_device_float_bounds</span><span class="p">(</span><span class="n">new_device</span><span class="p">)</span>
</span><span id="cast_to_supported_and_move_-227"><a href="#cast_to_supported_and_move_-227"><span class="linenos">227</span></a>	<span class="n">low_sint</span><span class="p">,</span> <span class="n">high_sint</span> <span class="o">=</span> <span class="n">compatibility</span><span class="o">.</span><span class="n">get_device_sint_bounds</span><span class="p">(</span><span class="n">new_device</span><span class="p">)</span>
</span><span id="cast_to_supported_and_move_-228"><a href="#cast_to_supported_and_move_-228"><span class="linenos">228</span></a>	<span class="n">low_uint</span><span class="p">,</span> <span class="n">high_uint</span> <span class="o">=</span> <span class="n">compatibility</span><span class="o">.</span><span class="n">get_device_uint_bounds</span><span class="p">(</span><span class="n">new_device</span><span class="p">)</span>
</span><span id="cast_to_supported_and_move_-229"><a href="#cast_to_supported_and_move_-229"><span class="linenos">229</span></a>	<span class="n">obj</span> <span class="o">=</span> <span class="n">limit_float_precision</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">low_float</span><span class="p">,</span> <span class="n">high_float</span><span class="p">,</span> <span class="n">new_device</span><span class="p">)</span>
</span><span id="cast_to_supported_and_move_-230"><a href="#cast_to_supported_and_move_-230"><span class="linenos">230</span></a>	<span class="n">obj</span> <span class="o">=</span> <span class="n">limit_sint_precision</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">low_sint</span><span class="p">,</span> <span class="n">high_sint</span><span class="p">,</span> <span class="n">new_device</span><span class="p">)</span>
</span><span id="cast_to_supported_and_move_-231"><a href="#cast_to_supported_and_move_-231"><span class="linenos">231</span></a>	<span class="n">obj</span> <span class="o">=</span> <span class="n">limit_uint_precision</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">low_uint</span><span class="p">,</span> <span class="n">high_uint</span><span class="p">,</span> <span class="n">new_device</span><span class="p">)</span>
</span><span id="cast_to_supported_and_move_-232"><a href="#cast_to_supported_and_move_-232"><span class="linenos">232</span></a>	<span class="k">return</span> <span class="n">obj</span>
</span></pre></div>


            <div class="docstring"><p>Cast all parameters/tensors of a model or tensor to dtypes supported by new_device, and</p>
</div>


                </section>
                <section id="QTensor">
                            <input id="QTensor-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">QTensor</span>:

                <label class="view-source-button" for="QTensor-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#QTensor"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="QTensor-11"><a href="#QTensor-11"><span class="linenos"> 11</span></a><span class="k">class</span><span class="w"> </span><span class="nc">QTensor</span><span class="p">:</span>
</span><span id="QTensor-12"><a href="#QTensor-12"><span class="linenos"> 12</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="QTensor-13"><a href="#QTensor-13"><span class="linenos"> 13</span></a><span class="sd">	A tensor with support for quantized data types, particularly those from GGUF.</span>
</span><span id="QTensor-14"><a href="#QTensor-14"><span class="linenos"> 14</span></a><span class="sd">	It will also support lower-precision data types on hardware without native support</span>
</span><span id="QTensor-15"><a href="#QTensor-15"><span class="linenos"> 15</span></a><span class="sd">	in the future.</span>
</span><span id="QTensor-16"><a href="#QTensor-16"><span class="linenos"> 16</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="QTensor-17"><a href="#QTensor-17"><span class="linenos"> 17</span></a>	<span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="QTensor-18"><a href="#QTensor-18"><span class="linenos"> 18</span></a>				<span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">],</span>
</span><span id="QTensor-19"><a href="#QTensor-19"><span class="linenos"> 19</span></a>				<span class="n">qtype</span><span class="p">,</span>
</span><span id="QTensor-20"><a href="#QTensor-20"><span class="linenos"> 20</span></a>				<span class="n">device</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="QTensor-21"><a href="#QTensor-21"><span class="linenos"> 21</span></a>		
</span><span id="QTensor-22"><a href="#QTensor-22"><span class="linenos"> 22</span></a>		<span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="QTensor-23"><a href="#QTensor-23"><span class="linenos"> 23</span></a>			<span class="n">device</span> <span class="o">=</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">Device</span><span class="o">.</span><span class="n">DEFAULT</span>
</span><span id="QTensor-24"><a href="#QTensor-24"><span class="linenos"> 24</span></a>		
</span><span id="QTensor-25"><a href="#QTensor-25"><span class="linenos"> 25</span></a>		<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">qtype</span><span class="p">,</span> <span class="n">GGMLQuantizationType</span><span class="p">):</span>
</span><span id="QTensor-26"><a href="#QTensor-26"><span class="linenos"> 26</span></a>			<span class="c1"># Only GGUF/GGML types are supported for now</span>
</span><span id="QTensor-27"><a href="#QTensor-27"><span class="linenos"> 27</span></a>			<span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="QTensor-28"><a href="#QTensor-28"><span class="linenos"> 28</span></a>		
</span><span id="QTensor-29"><a href="#QTensor-29"><span class="linenos"> 29</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_block_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type_size</span> <span class="o">=</span> <span class="n">GGML_QUANT_SIZES</span><span class="p">[</span><span class="n">qtype</span><span class="p">]</span>
</span><span id="QTensor-30"><a href="#QTensor-30"><span class="linenos"> 30</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_qtype</span> <span class="o">=</span> <span class="n">qtype</span>
</span><span id="QTensor-31"><a href="#QTensor-31"><span class="linenos"> 31</span></a>		
</span><span id="QTensor-32"><a href="#QTensor-32"><span class="linenos"> 32</span></a>		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="QTensor-33"><a href="#QTensor-33"><span class="linenos"> 33</span></a>			<span class="n">value</span> <span class="o">=</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">device</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
</span><span id="QTensor-34"><a href="#QTensor-34"><span class="linenos"> 34</span></a>		<span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
</span><span id="QTensor-35"><a href="#QTensor-35"><span class="linenos"> 35</span></a>			<span class="c1"># TODO: examine dtype?</span>
</span><span id="QTensor-36"><a href="#QTensor-36"><span class="linenos"> 36</span></a>			<span class="n">value</span> <span class="o">=</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">device</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
</span><span id="QTensor-37"><a href="#QTensor-37"><span class="linenos"> 37</span></a>		<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span>
</span><span id="QTensor-38"><a href="#QTensor-38"><span class="linenos"> 38</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_tg</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="QTensor-39"><a href="#QTensor-39"><span class="linenos"> 39</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_dequantized</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="QTensor-40"><a href="#QTensor-40"><span class="linenos"> 40</span></a>	
</span><span id="QTensor-41"><a href="#QTensor-41"><span class="linenos"> 41</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">dequantize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="QTensor-42"><a href="#QTensor-42"><span class="linenos"> 42</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="QTensor-43"><a href="#QTensor-43"><span class="linenos"> 43</span></a><span class="sd">		Returns the dequantized tensor, unrealized.</span>
</span><span id="QTensor-44"><a href="#QTensor-44"><span class="linenos"> 44</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="QTensor-45"><a href="#QTensor-45"><span class="linenos"> 45</span></a>		<span class="c1"># just to make things easier...</span>
</span><span id="QTensor-46"><a href="#QTensor-46"><span class="linenos"> 46</span></a>		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dequantized</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="QTensor-47"><a href="#QTensor-47"><span class="linenos"> 47</span></a>			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dequantized</span>
</span><span id="QTensor-48"><a href="#QTensor-48"><span class="linenos"> 48</span></a>		
</span><span id="QTensor-49"><a href="#QTensor-49"><span class="linenos"> 49</span></a>		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qtype</span> <span class="o">==</span> <span class="n">GGMLQuantizationType</span><span class="o">.</span><span class="n">F32</span><span class="p">:</span>
</span><span id="QTensor-50"><a href="#QTensor-50"><span class="linenos"> 50</span></a>			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tg</span><span class="o">.</span><span class="n">bitcast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
</span><span id="QTensor-51"><a href="#QTensor-51"><span class="linenos"> 51</span></a>		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qtype</span> <span class="o">==</span> <span class="n">GGMLQuantizationType</span><span class="o">.</span><span class="n">F16</span><span class="p">:</span>
</span><span id="QTensor-52"><a href="#QTensor-52"><span class="linenos"> 52</span></a>			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tg</span><span class="o">.</span><span class="n">bitcast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">half</span><span class="p">)</span>
</span><span id="QTensor-53"><a href="#QTensor-53"><span class="linenos"> 53</span></a>		
</span><span id="QTensor-54"><a href="#QTensor-54"><span class="linenos"> 54</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="QTensor-55"><a href="#QTensor-55"><span class="linenos"> 55</span></a>			<span class="c1"># for GGUF types</span>
</span><span id="QTensor-56"><a href="#QTensor-56"><span class="linenos"> 56</span></a>			<span class="n">blocks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tg</span><span class="o">.</span><span class="n">bitcast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</span><span id="QTensor-57"><a href="#QTensor-57"><span class="linenos"> 57</span></a>			<span class="n">shape</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">shape</span>
</span><span id="QTensor-58"><a href="#QTensor-58"><span class="linenos"> 58</span></a>			<span class="n">n_blocks</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">numel</span><span class="p">()</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type_size</span>
</span><span id="QTensor-59"><a href="#QTensor-59"><span class="linenos"> 59</span></a>			<span class="n">blocks</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type_size</span><span class="p">)</span>
</span><span id="QTensor-60"><a href="#QTensor-60"><span class="linenos"> 60</span></a>			
</span><span id="QTensor-61"><a href="#QTensor-61"><span class="linenos"> 61</span></a>			<span class="c1"># Now we actually have to do the dtype-specific parts</span>
</span><span id="QTensor-62"><a href="#QTensor-62"><span class="linenos"> 62</span></a>			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qtype</span> <span class="o">==</span> <span class="n">GGMLQuantizationType</span><span class="o">.</span><span class="n">Q2_K</span><span class="p">:</span>
</span><span id="QTensor-63"><a href="#QTensor-63"><span class="linenos"> 63</span></a>				<span class="n">scales</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">hsplit</span><span class="p">(</span><span class="n">blocks</span><span class="p">,</span> <span class="p">[</span><span class="n">QK_K</span> <span class="o">//</span> <span class="mi">16</span><span class="p">])</span>
</span><span id="QTensor-64"><a href="#QTensor-64"><span class="linenos"> 64</span></a>				<span class="n">qs</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">hsplit</span><span class="p">(</span><span class="n">rest</span><span class="p">,</span> <span class="p">[</span><span class="n">QK_K</span> <span class="o">//</span> <span class="mi">4</span><span class="p">])</span>
</span><span id="QTensor-65"><a href="#QTensor-65"><span class="linenos"> 65</span></a>				<span class="n">d</span><span class="p">,</span> <span class="n">dmin</span> <span class="o">=</span> <span class="n">hsplit</span><span class="p">(</span><span class="n">rest</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="QTensor-66"><a href="#QTensor-66"><span class="linenos"> 66</span></a>
</span><span id="QTensor-67"><a href="#QTensor-67"><span class="linenos"> 67</span></a>				<span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">bitcast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">half</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
</span><span id="QTensor-68"><a href="#QTensor-68"><span class="linenos"> 68</span></a>				<span class="n">dmin</span> <span class="o">=</span> <span class="n">dmin</span><span class="o">.</span><span class="n">bitcast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">half</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
</span><span id="QTensor-69"><a href="#QTensor-69"><span class="linenos"> 69</span></a>
</span><span id="QTensor-70"><a href="#QTensor-70"><span class="linenos"> 70</span></a>				<span class="c1"># (n_blocks, 16, 1)</span>
</span><span id="QTensor-71"><a href="#QTensor-71"><span class="linenos"> 71</span></a>				<span class="n">dl</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="n">scales</span> <span class="o">&amp;</span> <span class="mh">0xF</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="n">QK_K</span> <span class="o">//</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="QTensor-72"><a href="#QTensor-72"><span class="linenos"> 72</span></a>				<span class="n">ml</span> <span class="o">=</span> <span class="p">(</span><span class="n">dmin</span> <span class="o">*</span> <span class="p">(</span><span class="n">scales</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="n">QK_K</span> <span class="o">//</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="QTensor-73"><a href="#QTensor-73"><span class="linenos"> 73</span></a>				
</span><span id="QTensor-74"><a href="#QTensor-74"><span class="linenos"> 74</span></a>				<span class="n">to_cat</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="QTensor-75"><a href="#QTensor-75"><span class="linenos"> 75</span></a>				<span class="k">for</span> <span class="n">shift</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">]:</span>
</span><span id="QTensor-76"><a href="#QTensor-76"><span class="linenos"> 76</span></a>					<span class="n">to_cat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">qs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">shift</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3</span> <span class="p">)</span>
</span><span id="QTensor-77"><a href="#QTensor-77"><span class="linenos"> 77</span></a>				<span class="n">qs</span> <span class="o">=</span> <span class="n">Tensor</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="o">*</span><span class="n">to_cat</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="QTensor-78"><a href="#QTensor-78"><span class="linenos"> 78</span></a>				<span class="c1">#qs = (qs.reshape((n_blocks, -1, 1, 32)) &gt;&gt; shift) &amp; np.uint8(3)</span>
</span><span id="QTensor-79"><a href="#QTensor-79"><span class="linenos"> 79</span></a>
</span><span id="QTensor-80"><a href="#QTensor-80"><span class="linenos"> 80</span></a>				<span class="n">qs</span> <span class="o">=</span> <span class="n">qs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="n">QK_K</span> <span class="o">//</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="QTensor-81"><a href="#QTensor-81"><span class="linenos"> 81</span></a>
</span><span id="QTensor-82"><a href="#QTensor-82"><span class="linenos"> 82</span></a>				<span class="n">qs</span> <span class="o">=</span> <span class="n">dl</span> <span class="o">*</span> <span class="n">qs</span> <span class="o">-</span> <span class="n">ml</span>
</span><span id="QTensor-83"><a href="#QTensor-83"><span class="linenos"> 83</span></a>
</span><span id="QTensor-84"><a href="#QTensor-84"><span class="linenos"> 84</span></a>				<span class="n">blocks</span> <span class="o">=</span> <span class="n">qs</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">n_blocks</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="QTensor-85"><a href="#QTensor-85"><span class="linenos"> 85</span></a>			
</span><span id="QTensor-86"><a href="#QTensor-86"><span class="linenos"> 86</span></a>			<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qtype</span> <span class="o">==</span> <span class="n">GGMLQuantizationType</span><span class="o">.</span><span class="n">Q3_K</span><span class="p">:</span>
</span><span id="QTensor-87"><a href="#QTensor-87"><span class="linenos"> 87</span></a>				<span class="n">hmask</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">hsplit</span><span class="p">(</span><span class="n">blocks</span><span class="p">,</span> <span class="p">[</span><span class="n">QK_K</span> <span class="o">//</span> <span class="mi">8</span><span class="p">])</span>
</span><span id="QTensor-88"><a href="#QTensor-88"><span class="linenos"> 88</span></a>				<span class="n">qs</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">hsplit</span><span class="p">(</span><span class="n">rest</span><span class="p">,</span> <span class="p">[</span><span class="n">QK_K</span> <span class="o">//</span> <span class="mi">4</span><span class="p">])</span>
</span><span id="QTensor-89"><a href="#QTensor-89"><span class="linenos"> 89</span></a>				<span class="n">scales</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">hsplit</span><span class="p">(</span><span class="n">rest</span><span class="p">,</span> <span class="p">[</span><span class="mi">12</span><span class="p">])</span>
</span><span id="QTensor-90"><a href="#QTensor-90"><span class="linenos"> 90</span></a>
</span><span id="QTensor-91"><a href="#QTensor-91"><span class="linenos"> 91</span></a>				<span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">bitcast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="QTensor-92"><a href="#QTensor-92"><span class="linenos"> 92</span></a>
</span><span id="QTensor-93"><a href="#QTensor-93"><span class="linenos"> 93</span></a>				<span class="c1"># The scales are packed at 6-bit each in this pattern:</span>
</span><span id="QTensor-94"><a href="#QTensor-94"><span class="linenos"> 94</span></a>				<span class="c1">#  0: IIIIAAAA</span>
</span><span id="QTensor-95"><a href="#QTensor-95"><span class="linenos"> 95</span></a>				<span class="c1">#  1: JJJJBBBB</span>
</span><span id="QTensor-96"><a href="#QTensor-96"><span class="linenos"> 96</span></a>				<span class="c1">#  2: KKKKCCCC</span>
</span><span id="QTensor-97"><a href="#QTensor-97"><span class="linenos"> 97</span></a>				<span class="c1">#  3: LLLLDDDD</span>
</span><span id="QTensor-98"><a href="#QTensor-98"><span class="linenos"> 98</span></a>				<span class="c1">#  4: MMMMEEEE</span>
</span><span id="QTensor-99"><a href="#QTensor-99"><span class="linenos"> 99</span></a>				<span class="c1">#  5: NNNNFFFF</span>
</span><span id="QTensor-100"><a href="#QTensor-100"><span class="linenos">100</span></a>				<span class="c1">#  6: OOOOGGGG</span>
</span><span id="QTensor-101"><a href="#QTensor-101"><span class="linenos">101</span></a>				<span class="c1">#  7: PPPPHHHH</span>
</span><span id="QTensor-102"><a href="#QTensor-102"><span class="linenos">102</span></a>				<span class="c1">#  8: MMIIEEAA</span>
</span><span id="QTensor-103"><a href="#QTensor-103"><span class="linenos">103</span></a>				<span class="c1">#  9: NNJJFFBB</span>
</span><span id="QTensor-104"><a href="#QTensor-104"><span class="linenos">104</span></a>				<span class="c1"># 10: OOKKGGCC</span>
</span><span id="QTensor-105"><a href="#QTensor-105"><span class="linenos">105</span></a>				<span class="c1"># 11: PPLLHHDD</span>
</span><span id="QTensor-106"><a href="#QTensor-106"><span class="linenos">106</span></a>				<span class="n">lscales</span><span class="p">,</span> <span class="n">hscales</span> <span class="o">=</span> <span class="n">hsplit</span><span class="p">(</span><span class="n">scales</span><span class="p">,</span> <span class="p">[</span><span class="mi">8</span><span class="p">])</span>
</span><span id="QTensor-107"><a href="#QTensor-107"><span class="linenos">107</span></a>				<span class="n">lscales</span> <span class="o">=</span> <span class="n">lscales</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span><span id="QTensor-108"><a href="#QTensor-108"><span class="linenos">108</span></a>				<span class="n">lscales</span> <span class="o">=</span> <span class="p">(</span><span class="n">lscales</span> <span class="o">&gt;&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">lscales</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="QTensor-109"><a href="#QTensor-109"><span class="linenos">109</span></a>				<span class="n">lscales</span> <span class="o">=</span> <span class="n">lscales</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
</span><span id="QTensor-110"><a href="#QTensor-110"><span class="linenos">110</span></a>				
</span><span id="QTensor-111"><a href="#QTensor-111"><span class="linenos">111</span></a>				<span class="n">hscales</span> <span class="o">=</span> <span class="n">broadcast_rshift</span><span class="p">(</span><span class="n">hscales</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="QTensor-112"><a href="#QTensor-112"><span class="linenos">112</span></a>				
</span><span id="QTensor-113"><a href="#QTensor-113"><span class="linenos">113</span></a>				<span class="n">hscales</span> <span class="o">=</span> <span class="n">hscales</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
</span><span id="QTensor-114"><a href="#QTensor-114"><span class="linenos">114</span></a>				<span class="n">scales</span> <span class="o">=</span> <span class="p">(</span><span class="n">lscales</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span> <span class="p">(</span><span class="n">hscales</span> <span class="o">&amp;</span> <span class="mh">0x03</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span> <span class="p">)</span>
</span><span id="QTensor-115"><a href="#QTensor-115"><span class="linenos">115</span></a>				<span class="n">scales</span> <span class="o">=</span> <span class="p">(</span><span class="n">scales</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span> <span class="o">-</span> <span class="mi">32</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="QTensor-116"><a href="#QTensor-116"><span class="linenos">116</span></a>
</span><span id="QTensor-117"><a href="#QTensor-117"><span class="linenos">117</span></a>				<span class="n">dl</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span> <span class="o">*</span> <span class="n">scales</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="QTensor-118"><a href="#QTensor-118"><span class="linenos">118</span></a>				
</span><span id="QTensor-119"><a href="#QTensor-119"><span class="linenos">119</span></a>				<span class="n">ql</span> <span class="o">=</span> <span class="n">broadcast_rshift</span><span class="p">(</span><span class="n">qs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="QTensor-120"><a href="#QTensor-120"><span class="linenos">120</span></a>				
</span><span id="QTensor-121"><a href="#QTensor-121"><span class="linenos">121</span></a>				<span class="c1"># and this one</span>
</span><span id="QTensor-122"><a href="#QTensor-122"><span class="linenos">122</span></a>				<span class="c1">#qh = hmask.reshape(n_blocks, -1, 1, 32) &gt;&gt; np.array([i for i in range(8)], dtype=np.uint8).reshape((1, 1, 8, 1))</span>
</span><span id="QTensor-123"><a href="#QTensor-123"><span class="linenos">123</span></a>				<span class="n">qh</span> <span class="o">=</span> <span class="n">broadcast_rshift</span><span class="p">(</span><span class="n">hmask</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="QTensor-124"><a href="#QTensor-124"><span class="linenos">124</span></a>				
</span><span id="QTensor-125"><a href="#QTensor-125"><span class="linenos">125</span></a>				<span class="n">ql</span> <span class="o">=</span> <span class="n">ql</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">QK_K</span> <span class="o">//</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3</span>
</span><span id="QTensor-126"><a href="#QTensor-126"><span class="linenos">126</span></a>				<span class="n">qh</span> <span class="o">=</span> <span class="n">qh</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">QK_K</span> <span class="o">//</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1</span>
</span><span id="QTensor-127"><a href="#QTensor-127"><span class="linenos">127</span></a>				<span class="n">qh</span> <span class="o">=</span> <span class="n">qh</span> <span class="o">^</span> <span class="mh">0x1</span>  <span class="c1"># strangely, the offset is zero when the bitmask is 1</span>
</span><span id="QTensor-128"><a href="#QTensor-128"><span class="linenos">128</span></a>				<span class="n">q</span> <span class="o">=</span> <span class="p">(</span><span class="n">ql</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">qh</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">int8</span><span class="p">))</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="QTensor-129"><a href="#QTensor-129"><span class="linenos">129</span></a>
</span><span id="QTensor-130"><a href="#QTensor-130"><span class="linenos">130</span></a>				<span class="n">blocks</span> <span class="o">=</span> <span class="p">(</span><span class="n">dl</span> <span class="o">*</span> <span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="n">QK_K</span><span class="p">)</span>
</span><span id="QTensor-131"><a href="#QTensor-131"><span class="linenos">131</span></a>				
</span><span id="QTensor-132"><a href="#QTensor-132"><span class="linenos">132</span></a>			<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qtype</span> <span class="o">==</span> <span class="n">GGMLQuantizationType</span><span class="o">.</span><span class="n">Q6_K</span><span class="p">:</span>
</span><span id="QTensor-133"><a href="#QTensor-133"><span class="linenos">133</span></a>				<span class="n">ql</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">hsplit</span><span class="p">(</span><span class="n">blocks</span><span class="p">,</span> <span class="p">[</span><span class="n">QK_K</span> <span class="o">//</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="QTensor-134"><a href="#QTensor-134"><span class="linenos">134</span></a>				<span class="n">qh</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">hsplit</span><span class="p">(</span><span class="n">rest</span><span class="p">,</span> <span class="p">[</span><span class="n">QK_K</span> <span class="o">//</span> <span class="mi">4</span><span class="p">])</span>
</span><span id="QTensor-135"><a href="#QTensor-135"><span class="linenos">135</span></a>				<span class="n">scales</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">hsplit</span><span class="p">(</span><span class="n">rest</span><span class="p">,</span> <span class="p">[</span><span class="n">QK_K</span> <span class="o">//</span> <span class="mi">16</span><span class="p">])</span>
</span><span id="QTensor-136"><a href="#QTensor-136"><span class="linenos">136</span></a>				
</span><span id="QTensor-137"><a href="#QTensor-137"><span class="linenos">137</span></a>				<span class="n">scales</span> <span class="o">=</span> <span class="n">scales</span><span class="o">.</span><span class="n">bitcast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
</span><span id="QTensor-138"><a href="#QTensor-138"><span class="linenos">138</span></a>				<span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">bitcast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">half</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
</span><span id="QTensor-139"><a href="#QTensor-139"><span class="linenos">139</span></a>				<span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span> <span class="o">*</span> <span class="n">scales</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="n">QK_K</span> <span class="o">//</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="QTensor-140"><a href="#QTensor-140"><span class="linenos">140</span></a>				
</span><span id="QTensor-141"><a href="#QTensor-141"><span class="linenos">141</span></a>				<span class="n">tocat</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="QTensor-142"><a href="#QTensor-142"><span class="linenos">142</span></a>				<span class="k">for</span> <span class="n">shift</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">]:</span>
</span><span id="QTensor-143"><a href="#QTensor-143"><span class="linenos">143</span></a>					<span class="n">tocat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ql</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">shift</span><span class="p">)</span>
</span><span id="QTensor-144"><a href="#QTensor-144"><span class="linenos">144</span></a>				<span class="n">ql</span> <span class="o">=</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="o">*</span><span class="n">tocat</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="QTensor-145"><a href="#QTensor-145"><span class="linenos">145</span></a>				<span class="n">ql</span> <span class="o">=</span> <span class="p">(</span><span class="n">ql</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
</span><span id="QTensor-146"><a href="#QTensor-146"><span class="linenos">146</span></a>				
</span><span id="QTensor-147"><a href="#QTensor-147"><span class="linenos">147</span></a>				<span class="n">tocat</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="QTensor-148"><a href="#QTensor-148"><span class="linenos">148</span></a>				<span class="k">for</span> <span class="n">shift</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">]:</span>
</span><span id="QTensor-149"><a href="#QTensor-149"><span class="linenos">149</span></a>					<span class="n">tocat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qh</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">shift</span><span class="p">)</span>
</span><span id="QTensor-150"><a href="#QTensor-150"><span class="linenos">150</span></a>				<span class="n">qh</span> <span class="o">=</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="o">*</span><span class="n">tocat</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="QTensor-151"><a href="#QTensor-151"><span class="linenos">151</span></a>				<span class="n">qh</span> <span class="o">=</span> <span class="p">(</span><span class="n">qh</span> <span class="o">&amp;</span> <span class="mh">0x03</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">n_blocks</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">))</span>
</span><span id="QTensor-152"><a href="#QTensor-152"><span class="linenos">152</span></a>				<span class="n">q</span> <span class="o">=</span> <span class="p">(</span><span class="n">ql</span> <span class="o">|</span> <span class="p">(</span><span class="n">qh</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span> <span class="o">-</span> <span class="mi">32</span>
</span><span id="QTensor-153"><a href="#QTensor-153"><span class="linenos">153</span></a>				<span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="n">QK_K</span> <span class="o">//</span> <span class="mi">16</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
</span><span id="QTensor-154"><a href="#QTensor-154"><span class="linenos">154</span></a>				<span class="n">blocks</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span> <span class="o">*</span> <span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">n_blocks</span><span class="p">,</span> <span class="n">QK_K</span><span class="p">))</span>
</span><span id="QTensor-155"><a href="#QTensor-155"><span class="linenos">155</span></a>			<span class="k">else</span><span class="p">:</span>
</span><span id="QTensor-156"><a href="#QTensor-156"><span class="linenos">156</span></a>				<span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_get_ggml_qtype_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_qtype</span><span class="p">)</span><span class="si">}</span><span class="s2"> dequantization not yet implemented&quot;</span><span class="p">)</span>
</span><span id="QTensor-157"><a href="#QTensor-157"><span class="linenos">157</span></a>			
</span><span id="QTensor-158"><a href="#QTensor-158"><span class="linenos">158</span></a>			<span class="c1"># sanity check present in original gguf code</span>
</span><span id="QTensor-159"><a href="#QTensor-159"><span class="linenos">159</span></a>			<span class="k">assert</span> <span class="n">blocks</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">dtypes</span><span class="o">.</span><span class="n">float</span>
</span><span id="QTensor-160"><a href="#QTensor-160"><span class="linenos">160</span></a>			<span class="k">assert</span> <span class="n">blocks</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_block_size</span>
</span><span id="QTensor-161"><a href="#QTensor-161"><span class="linenos">161</span></a>			
</span><span id="QTensor-162"><a href="#QTensor-162"><span class="linenos">162</span></a>			<span class="c1"># reshape into proper tensor shape</span>
</span><span id="QTensor-163"><a href="#QTensor-163"><span class="linenos">163</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">_dequantized</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">*</span><span class="n">quant_shape_from_byte_shape</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qtype</span><span class="p">)</span> <span class="p">)</span>
</span><span id="QTensor-164"><a href="#QTensor-164"><span class="linenos">164</span></a>			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dequantized</span>
</span><span id="QTensor-165"><a href="#QTensor-165"><span class="linenos">165</span></a>		
</span><span id="QTensor-166"><a href="#QTensor-166"><span class="linenos">166</span></a>		<span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
</span><span id="QTensor-167"><a href="#QTensor-167"><span class="linenos">167</span></a><span class="w">			</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="QTensor-168"><a href="#QTensor-168"><span class="linenos">168</span></a><span class="sd">			@public</span>
</span><span id="QTensor-169"><a href="#QTensor-169"><span class="linenos">169</span></a><span class="sd">			Provides a wrapper that allows</span>
</span><span id="QTensor-170"><a href="#QTensor-170"><span class="linenos">170</span></a><span class="sd">			```</span>
</span><span id="QTensor-171"><a href="#QTensor-171"><span class="linenos">171</span></a><span class="sd">			self.attribute</span>
</span><span id="QTensor-172"><a href="#QTensor-172"><span class="linenos">172</span></a><span class="sd">			```</span>
</span><span id="QTensor-173"><a href="#QTensor-173"><span class="linenos">173</span></a><span class="sd">			</span>
</span><span id="QTensor-174"><a href="#QTensor-174"><span class="linenos">174</span></a><span class="sd">			to be treated as</span>
</span><span id="QTensor-175"><a href="#QTensor-175"><span class="linenos">175</span></a><span class="sd">			</span>
</span><span id="QTensor-176"><a href="#QTensor-176"><span class="linenos">176</span></a><span class="sd">			```</span>
</span><span id="QTensor-177"><a href="#QTensor-177"><span class="linenos">177</span></a><span class="sd">			self.dequantize().attribute</span>
</span><span id="QTensor-178"><a href="#QTensor-178"><span class="linenos">178</span></a><span class="sd">			```</span>
</span><span id="QTensor-179"><a href="#QTensor-179"><span class="linenos">179</span></a><span class="sd">			&quot;&quot;&quot;</span>
</span><span id="QTensor-180"><a href="#QTensor-180"><span class="linenos">180</span></a>			<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tg</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
</span><span id="QTensor-181"><a href="#QTensor-181"><span class="linenos">181</span></a>				<span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dequantize</span><span class="p">(),</span> <span class="n">attr</span><span class="p">)</span>
</span><span id="QTensor-182"><a href="#QTensor-182"><span class="linenos">182</span></a>			<span class="k">else</span><span class="p">:</span>
</span><span id="QTensor-183"><a href="#QTensor-183"><span class="linenos">183</span></a>				<span class="k">raise</span> <span class="ne">AttributeError</span>
</span></pre></div>


            <div class="docstring"><p>A tensor with support for quantized data types, particularly those from GGUF.
It will also support lower-precision data types on hardware without native support
in the future.</p>
</div>


                            <div id="QTensor.__init__" class="classattr">
                                        <input id="QTensor.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">QTensor</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">tinygrad</span><span class="o">.</span><span class="n">tensor</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]</span>,</span><span class="param">	<span class="n">qtype</span>,</span><span class="param">	<span class="n">device</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="QTensor.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#QTensor.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="QTensor.__init__-17"><a href="#QTensor.__init__-17"><span class="linenos">17</span></a>	<span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="QTensor.__init__-18"><a href="#QTensor.__init__-18"><span class="linenos">18</span></a>				<span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">],</span>
</span><span id="QTensor.__init__-19"><a href="#QTensor.__init__-19"><span class="linenos">19</span></a>				<span class="n">qtype</span><span class="p">,</span>
</span><span id="QTensor.__init__-20"><a href="#QTensor.__init__-20"><span class="linenos">20</span></a>				<span class="n">device</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="QTensor.__init__-21"><a href="#QTensor.__init__-21"><span class="linenos">21</span></a>		
</span><span id="QTensor.__init__-22"><a href="#QTensor.__init__-22"><span class="linenos">22</span></a>		<span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="QTensor.__init__-23"><a href="#QTensor.__init__-23"><span class="linenos">23</span></a>			<span class="n">device</span> <span class="o">=</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">Device</span><span class="o">.</span><span class="n">DEFAULT</span>
</span><span id="QTensor.__init__-24"><a href="#QTensor.__init__-24"><span class="linenos">24</span></a>		
</span><span id="QTensor.__init__-25"><a href="#QTensor.__init__-25"><span class="linenos">25</span></a>		<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">qtype</span><span class="p">,</span> <span class="n">GGMLQuantizationType</span><span class="p">):</span>
</span><span id="QTensor.__init__-26"><a href="#QTensor.__init__-26"><span class="linenos">26</span></a>			<span class="c1"># Only GGUF/GGML types are supported for now</span>
</span><span id="QTensor.__init__-27"><a href="#QTensor.__init__-27"><span class="linenos">27</span></a>			<span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="QTensor.__init__-28"><a href="#QTensor.__init__-28"><span class="linenos">28</span></a>		
</span><span id="QTensor.__init__-29"><a href="#QTensor.__init__-29"><span class="linenos">29</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_block_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type_size</span> <span class="o">=</span> <span class="n">GGML_QUANT_SIZES</span><span class="p">[</span><span class="n">qtype</span><span class="p">]</span>
</span><span id="QTensor.__init__-30"><a href="#QTensor.__init__-30"><span class="linenos">30</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_qtype</span> <span class="o">=</span> <span class="n">qtype</span>
</span><span id="QTensor.__init__-31"><a href="#QTensor.__init__-31"><span class="linenos">31</span></a>		
</span><span id="QTensor.__init__-32"><a href="#QTensor.__init__-32"><span class="linenos">32</span></a>		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="QTensor.__init__-33"><a href="#QTensor.__init__-33"><span class="linenos">33</span></a>			<span class="n">value</span> <span class="o">=</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">device</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
</span><span id="QTensor.__init__-34"><a href="#QTensor.__init__-34"><span class="linenos">34</span></a>		<span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
</span><span id="QTensor.__init__-35"><a href="#QTensor.__init__-35"><span class="linenos">35</span></a>			<span class="c1"># TODO: examine dtype?</span>
</span><span id="QTensor.__init__-36"><a href="#QTensor.__init__-36"><span class="linenos">36</span></a>			<span class="n">value</span> <span class="o">=</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">device</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
</span><span id="QTensor.__init__-37"><a href="#QTensor.__init__-37"><span class="linenos">37</span></a>		<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span>
</span><span id="QTensor.__init__-38"><a href="#QTensor.__init__-38"><span class="linenos">38</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_tg</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="QTensor.__init__-39"><a href="#QTensor.__init__-39"><span class="linenos">39</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_dequantized</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>


    

                            </div>
                            <div id="QTensor.dequantize" class="classattr">
                                        <input id="QTensor.dequantize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">dequantize</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="QTensor.dequantize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#QTensor.dequantize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="QTensor.dequantize-41"><a href="#QTensor.dequantize-41"><span class="linenos"> 41</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">dequantize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="QTensor.dequantize-42"><a href="#QTensor.dequantize-42"><span class="linenos"> 42</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="QTensor.dequantize-43"><a href="#QTensor.dequantize-43"><span class="linenos"> 43</span></a><span class="sd">		Returns the dequantized tensor, unrealized.</span>
</span><span id="QTensor.dequantize-44"><a href="#QTensor.dequantize-44"><span class="linenos"> 44</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="QTensor.dequantize-45"><a href="#QTensor.dequantize-45"><span class="linenos"> 45</span></a>		<span class="c1"># just to make things easier...</span>
</span><span id="QTensor.dequantize-46"><a href="#QTensor.dequantize-46"><span class="linenos"> 46</span></a>		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dequantized</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="QTensor.dequantize-47"><a href="#QTensor.dequantize-47"><span class="linenos"> 47</span></a>			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dequantized</span>
</span><span id="QTensor.dequantize-48"><a href="#QTensor.dequantize-48"><span class="linenos"> 48</span></a>		
</span><span id="QTensor.dequantize-49"><a href="#QTensor.dequantize-49"><span class="linenos"> 49</span></a>		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qtype</span> <span class="o">==</span> <span class="n">GGMLQuantizationType</span><span class="o">.</span><span class="n">F32</span><span class="p">:</span>
</span><span id="QTensor.dequantize-50"><a href="#QTensor.dequantize-50"><span class="linenos"> 50</span></a>			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tg</span><span class="o">.</span><span class="n">bitcast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
</span><span id="QTensor.dequantize-51"><a href="#QTensor.dequantize-51"><span class="linenos"> 51</span></a>		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qtype</span> <span class="o">==</span> <span class="n">GGMLQuantizationType</span><span class="o">.</span><span class="n">F16</span><span class="p">:</span>
</span><span id="QTensor.dequantize-52"><a href="#QTensor.dequantize-52"><span class="linenos"> 52</span></a>			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tg</span><span class="o">.</span><span class="n">bitcast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">half</span><span class="p">)</span>
</span><span id="QTensor.dequantize-53"><a href="#QTensor.dequantize-53"><span class="linenos"> 53</span></a>		
</span><span id="QTensor.dequantize-54"><a href="#QTensor.dequantize-54"><span class="linenos"> 54</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="QTensor.dequantize-55"><a href="#QTensor.dequantize-55"><span class="linenos"> 55</span></a>			<span class="c1"># for GGUF types</span>
</span><span id="QTensor.dequantize-56"><a href="#QTensor.dequantize-56"><span class="linenos"> 56</span></a>			<span class="n">blocks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tg</span><span class="o">.</span><span class="n">bitcast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</span><span id="QTensor.dequantize-57"><a href="#QTensor.dequantize-57"><span class="linenos"> 57</span></a>			<span class="n">shape</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">shape</span>
</span><span id="QTensor.dequantize-58"><a href="#QTensor.dequantize-58"><span class="linenos"> 58</span></a>			<span class="n">n_blocks</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">numel</span><span class="p">()</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type_size</span>
</span><span id="QTensor.dequantize-59"><a href="#QTensor.dequantize-59"><span class="linenos"> 59</span></a>			<span class="n">blocks</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type_size</span><span class="p">)</span>
</span><span id="QTensor.dequantize-60"><a href="#QTensor.dequantize-60"><span class="linenos"> 60</span></a>			
</span><span id="QTensor.dequantize-61"><a href="#QTensor.dequantize-61"><span class="linenos"> 61</span></a>			<span class="c1"># Now we actually have to do the dtype-specific parts</span>
</span><span id="QTensor.dequantize-62"><a href="#QTensor.dequantize-62"><span class="linenos"> 62</span></a>			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qtype</span> <span class="o">==</span> <span class="n">GGMLQuantizationType</span><span class="o">.</span><span class="n">Q2_K</span><span class="p">:</span>
</span><span id="QTensor.dequantize-63"><a href="#QTensor.dequantize-63"><span class="linenos"> 63</span></a>				<span class="n">scales</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">hsplit</span><span class="p">(</span><span class="n">blocks</span><span class="p">,</span> <span class="p">[</span><span class="n">QK_K</span> <span class="o">//</span> <span class="mi">16</span><span class="p">])</span>
</span><span id="QTensor.dequantize-64"><a href="#QTensor.dequantize-64"><span class="linenos"> 64</span></a>				<span class="n">qs</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">hsplit</span><span class="p">(</span><span class="n">rest</span><span class="p">,</span> <span class="p">[</span><span class="n">QK_K</span> <span class="o">//</span> <span class="mi">4</span><span class="p">])</span>
</span><span id="QTensor.dequantize-65"><a href="#QTensor.dequantize-65"><span class="linenos"> 65</span></a>				<span class="n">d</span><span class="p">,</span> <span class="n">dmin</span> <span class="o">=</span> <span class="n">hsplit</span><span class="p">(</span><span class="n">rest</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="QTensor.dequantize-66"><a href="#QTensor.dequantize-66"><span class="linenos"> 66</span></a>
</span><span id="QTensor.dequantize-67"><a href="#QTensor.dequantize-67"><span class="linenos"> 67</span></a>				<span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">bitcast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">half</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
</span><span id="QTensor.dequantize-68"><a href="#QTensor.dequantize-68"><span class="linenos"> 68</span></a>				<span class="n">dmin</span> <span class="o">=</span> <span class="n">dmin</span><span class="o">.</span><span class="n">bitcast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">half</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
</span><span id="QTensor.dequantize-69"><a href="#QTensor.dequantize-69"><span class="linenos"> 69</span></a>
</span><span id="QTensor.dequantize-70"><a href="#QTensor.dequantize-70"><span class="linenos"> 70</span></a>				<span class="c1"># (n_blocks, 16, 1)</span>
</span><span id="QTensor.dequantize-71"><a href="#QTensor.dequantize-71"><span class="linenos"> 71</span></a>				<span class="n">dl</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="n">scales</span> <span class="o">&amp;</span> <span class="mh">0xF</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="n">QK_K</span> <span class="o">//</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="QTensor.dequantize-72"><a href="#QTensor.dequantize-72"><span class="linenos"> 72</span></a>				<span class="n">ml</span> <span class="o">=</span> <span class="p">(</span><span class="n">dmin</span> <span class="o">*</span> <span class="p">(</span><span class="n">scales</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="n">QK_K</span> <span class="o">//</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="QTensor.dequantize-73"><a href="#QTensor.dequantize-73"><span class="linenos"> 73</span></a>				
</span><span id="QTensor.dequantize-74"><a href="#QTensor.dequantize-74"><span class="linenos"> 74</span></a>				<span class="n">to_cat</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="QTensor.dequantize-75"><a href="#QTensor.dequantize-75"><span class="linenos"> 75</span></a>				<span class="k">for</span> <span class="n">shift</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">]:</span>
</span><span id="QTensor.dequantize-76"><a href="#QTensor.dequantize-76"><span class="linenos"> 76</span></a>					<span class="n">to_cat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">qs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">shift</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3</span> <span class="p">)</span>
</span><span id="QTensor.dequantize-77"><a href="#QTensor.dequantize-77"><span class="linenos"> 77</span></a>				<span class="n">qs</span> <span class="o">=</span> <span class="n">Tensor</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="o">*</span><span class="n">to_cat</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="QTensor.dequantize-78"><a href="#QTensor.dequantize-78"><span class="linenos"> 78</span></a>				<span class="c1">#qs = (qs.reshape((n_blocks, -1, 1, 32)) &gt;&gt; shift) &amp; np.uint8(3)</span>
</span><span id="QTensor.dequantize-79"><a href="#QTensor.dequantize-79"><span class="linenos"> 79</span></a>
</span><span id="QTensor.dequantize-80"><a href="#QTensor.dequantize-80"><span class="linenos"> 80</span></a>				<span class="n">qs</span> <span class="o">=</span> <span class="n">qs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="n">QK_K</span> <span class="o">//</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="QTensor.dequantize-81"><a href="#QTensor.dequantize-81"><span class="linenos"> 81</span></a>
</span><span id="QTensor.dequantize-82"><a href="#QTensor.dequantize-82"><span class="linenos"> 82</span></a>				<span class="n">qs</span> <span class="o">=</span> <span class="n">dl</span> <span class="o">*</span> <span class="n">qs</span> <span class="o">-</span> <span class="n">ml</span>
</span><span id="QTensor.dequantize-83"><a href="#QTensor.dequantize-83"><span class="linenos"> 83</span></a>
</span><span id="QTensor.dequantize-84"><a href="#QTensor.dequantize-84"><span class="linenos"> 84</span></a>				<span class="n">blocks</span> <span class="o">=</span> <span class="n">qs</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">n_blocks</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="QTensor.dequantize-85"><a href="#QTensor.dequantize-85"><span class="linenos"> 85</span></a>			
</span><span id="QTensor.dequantize-86"><a href="#QTensor.dequantize-86"><span class="linenos"> 86</span></a>			<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qtype</span> <span class="o">==</span> <span class="n">GGMLQuantizationType</span><span class="o">.</span><span class="n">Q3_K</span><span class="p">:</span>
</span><span id="QTensor.dequantize-87"><a href="#QTensor.dequantize-87"><span class="linenos"> 87</span></a>				<span class="n">hmask</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">hsplit</span><span class="p">(</span><span class="n">blocks</span><span class="p">,</span> <span class="p">[</span><span class="n">QK_K</span> <span class="o">//</span> <span class="mi">8</span><span class="p">])</span>
</span><span id="QTensor.dequantize-88"><a href="#QTensor.dequantize-88"><span class="linenos"> 88</span></a>				<span class="n">qs</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">hsplit</span><span class="p">(</span><span class="n">rest</span><span class="p">,</span> <span class="p">[</span><span class="n">QK_K</span> <span class="o">//</span> <span class="mi">4</span><span class="p">])</span>
</span><span id="QTensor.dequantize-89"><a href="#QTensor.dequantize-89"><span class="linenos"> 89</span></a>				<span class="n">scales</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">hsplit</span><span class="p">(</span><span class="n">rest</span><span class="p">,</span> <span class="p">[</span><span class="mi">12</span><span class="p">])</span>
</span><span id="QTensor.dequantize-90"><a href="#QTensor.dequantize-90"><span class="linenos"> 90</span></a>
</span><span id="QTensor.dequantize-91"><a href="#QTensor.dequantize-91"><span class="linenos"> 91</span></a>				<span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">bitcast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="QTensor.dequantize-92"><a href="#QTensor.dequantize-92"><span class="linenos"> 92</span></a>
</span><span id="QTensor.dequantize-93"><a href="#QTensor.dequantize-93"><span class="linenos"> 93</span></a>				<span class="c1"># The scales are packed at 6-bit each in this pattern:</span>
</span><span id="QTensor.dequantize-94"><a href="#QTensor.dequantize-94"><span class="linenos"> 94</span></a>				<span class="c1">#  0: IIIIAAAA</span>
</span><span id="QTensor.dequantize-95"><a href="#QTensor.dequantize-95"><span class="linenos"> 95</span></a>				<span class="c1">#  1: JJJJBBBB</span>
</span><span id="QTensor.dequantize-96"><a href="#QTensor.dequantize-96"><span class="linenos"> 96</span></a>				<span class="c1">#  2: KKKKCCCC</span>
</span><span id="QTensor.dequantize-97"><a href="#QTensor.dequantize-97"><span class="linenos"> 97</span></a>				<span class="c1">#  3: LLLLDDDD</span>
</span><span id="QTensor.dequantize-98"><a href="#QTensor.dequantize-98"><span class="linenos"> 98</span></a>				<span class="c1">#  4: MMMMEEEE</span>
</span><span id="QTensor.dequantize-99"><a href="#QTensor.dequantize-99"><span class="linenos"> 99</span></a>				<span class="c1">#  5: NNNNFFFF</span>
</span><span id="QTensor.dequantize-100"><a href="#QTensor.dequantize-100"><span class="linenos">100</span></a>				<span class="c1">#  6: OOOOGGGG</span>
</span><span id="QTensor.dequantize-101"><a href="#QTensor.dequantize-101"><span class="linenos">101</span></a>				<span class="c1">#  7: PPPPHHHH</span>
</span><span id="QTensor.dequantize-102"><a href="#QTensor.dequantize-102"><span class="linenos">102</span></a>				<span class="c1">#  8: MMIIEEAA</span>
</span><span id="QTensor.dequantize-103"><a href="#QTensor.dequantize-103"><span class="linenos">103</span></a>				<span class="c1">#  9: NNJJFFBB</span>
</span><span id="QTensor.dequantize-104"><a href="#QTensor.dequantize-104"><span class="linenos">104</span></a>				<span class="c1"># 10: OOKKGGCC</span>
</span><span id="QTensor.dequantize-105"><a href="#QTensor.dequantize-105"><span class="linenos">105</span></a>				<span class="c1"># 11: PPLLHHDD</span>
</span><span id="QTensor.dequantize-106"><a href="#QTensor.dequantize-106"><span class="linenos">106</span></a>				<span class="n">lscales</span><span class="p">,</span> <span class="n">hscales</span> <span class="o">=</span> <span class="n">hsplit</span><span class="p">(</span><span class="n">scales</span><span class="p">,</span> <span class="p">[</span><span class="mi">8</span><span class="p">])</span>
</span><span id="QTensor.dequantize-107"><a href="#QTensor.dequantize-107"><span class="linenos">107</span></a>				<span class="n">lscales</span> <span class="o">=</span> <span class="n">lscales</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span><span id="QTensor.dequantize-108"><a href="#QTensor.dequantize-108"><span class="linenos">108</span></a>				<span class="n">lscales</span> <span class="o">=</span> <span class="p">(</span><span class="n">lscales</span> <span class="o">&gt;&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">lscales</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="QTensor.dequantize-109"><a href="#QTensor.dequantize-109"><span class="linenos">109</span></a>				<span class="n">lscales</span> <span class="o">=</span> <span class="n">lscales</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
</span><span id="QTensor.dequantize-110"><a href="#QTensor.dequantize-110"><span class="linenos">110</span></a>				
</span><span id="QTensor.dequantize-111"><a href="#QTensor.dequantize-111"><span class="linenos">111</span></a>				<span class="n">hscales</span> <span class="o">=</span> <span class="n">broadcast_rshift</span><span class="p">(</span><span class="n">hscales</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="QTensor.dequantize-112"><a href="#QTensor.dequantize-112"><span class="linenos">112</span></a>				
</span><span id="QTensor.dequantize-113"><a href="#QTensor.dequantize-113"><span class="linenos">113</span></a>				<span class="n">hscales</span> <span class="o">=</span> <span class="n">hscales</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
</span><span id="QTensor.dequantize-114"><a href="#QTensor.dequantize-114"><span class="linenos">114</span></a>				<span class="n">scales</span> <span class="o">=</span> <span class="p">(</span><span class="n">lscales</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span> <span class="p">(</span><span class="n">hscales</span> <span class="o">&amp;</span> <span class="mh">0x03</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span> <span class="p">)</span>
</span><span id="QTensor.dequantize-115"><a href="#QTensor.dequantize-115"><span class="linenos">115</span></a>				<span class="n">scales</span> <span class="o">=</span> <span class="p">(</span><span class="n">scales</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span> <span class="o">-</span> <span class="mi">32</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="QTensor.dequantize-116"><a href="#QTensor.dequantize-116"><span class="linenos">116</span></a>
</span><span id="QTensor.dequantize-117"><a href="#QTensor.dequantize-117"><span class="linenos">117</span></a>				<span class="n">dl</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span> <span class="o">*</span> <span class="n">scales</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="QTensor.dequantize-118"><a href="#QTensor.dequantize-118"><span class="linenos">118</span></a>				
</span><span id="QTensor.dequantize-119"><a href="#QTensor.dequantize-119"><span class="linenos">119</span></a>				<span class="n">ql</span> <span class="o">=</span> <span class="n">broadcast_rshift</span><span class="p">(</span><span class="n">qs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="QTensor.dequantize-120"><a href="#QTensor.dequantize-120"><span class="linenos">120</span></a>				
</span><span id="QTensor.dequantize-121"><a href="#QTensor.dequantize-121"><span class="linenos">121</span></a>				<span class="c1"># and this one</span>
</span><span id="QTensor.dequantize-122"><a href="#QTensor.dequantize-122"><span class="linenos">122</span></a>				<span class="c1">#qh = hmask.reshape(n_blocks, -1, 1, 32) &gt;&gt; np.array([i for i in range(8)], dtype=np.uint8).reshape((1, 1, 8, 1))</span>
</span><span id="QTensor.dequantize-123"><a href="#QTensor.dequantize-123"><span class="linenos">123</span></a>				<span class="n">qh</span> <span class="o">=</span> <span class="n">broadcast_rshift</span><span class="p">(</span><span class="n">hmask</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="QTensor.dequantize-124"><a href="#QTensor.dequantize-124"><span class="linenos">124</span></a>				
</span><span id="QTensor.dequantize-125"><a href="#QTensor.dequantize-125"><span class="linenos">125</span></a>				<span class="n">ql</span> <span class="o">=</span> <span class="n">ql</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">QK_K</span> <span class="o">//</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3</span>
</span><span id="QTensor.dequantize-126"><a href="#QTensor.dequantize-126"><span class="linenos">126</span></a>				<span class="n">qh</span> <span class="o">=</span> <span class="n">qh</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">QK_K</span> <span class="o">//</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1</span>
</span><span id="QTensor.dequantize-127"><a href="#QTensor.dequantize-127"><span class="linenos">127</span></a>				<span class="n">qh</span> <span class="o">=</span> <span class="n">qh</span> <span class="o">^</span> <span class="mh">0x1</span>  <span class="c1"># strangely, the offset is zero when the bitmask is 1</span>
</span><span id="QTensor.dequantize-128"><a href="#QTensor.dequantize-128"><span class="linenos">128</span></a>				<span class="n">q</span> <span class="o">=</span> <span class="p">(</span><span class="n">ql</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">qh</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">int8</span><span class="p">))</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="QTensor.dequantize-129"><a href="#QTensor.dequantize-129"><span class="linenos">129</span></a>
</span><span id="QTensor.dequantize-130"><a href="#QTensor.dequantize-130"><span class="linenos">130</span></a>				<span class="n">blocks</span> <span class="o">=</span> <span class="p">(</span><span class="n">dl</span> <span class="o">*</span> <span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="n">QK_K</span><span class="p">)</span>
</span><span id="QTensor.dequantize-131"><a href="#QTensor.dequantize-131"><span class="linenos">131</span></a>				
</span><span id="QTensor.dequantize-132"><a href="#QTensor.dequantize-132"><span class="linenos">132</span></a>			<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qtype</span> <span class="o">==</span> <span class="n">GGMLQuantizationType</span><span class="o">.</span><span class="n">Q6_K</span><span class="p">:</span>
</span><span id="QTensor.dequantize-133"><a href="#QTensor.dequantize-133"><span class="linenos">133</span></a>				<span class="n">ql</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">hsplit</span><span class="p">(</span><span class="n">blocks</span><span class="p">,</span> <span class="p">[</span><span class="n">QK_K</span> <span class="o">//</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="QTensor.dequantize-134"><a href="#QTensor.dequantize-134"><span class="linenos">134</span></a>				<span class="n">qh</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">hsplit</span><span class="p">(</span><span class="n">rest</span><span class="p">,</span> <span class="p">[</span><span class="n">QK_K</span> <span class="o">//</span> <span class="mi">4</span><span class="p">])</span>
</span><span id="QTensor.dequantize-135"><a href="#QTensor.dequantize-135"><span class="linenos">135</span></a>				<span class="n">scales</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">hsplit</span><span class="p">(</span><span class="n">rest</span><span class="p">,</span> <span class="p">[</span><span class="n">QK_K</span> <span class="o">//</span> <span class="mi">16</span><span class="p">])</span>
</span><span id="QTensor.dequantize-136"><a href="#QTensor.dequantize-136"><span class="linenos">136</span></a>				
</span><span id="QTensor.dequantize-137"><a href="#QTensor.dequantize-137"><span class="linenos">137</span></a>				<span class="n">scales</span> <span class="o">=</span> <span class="n">scales</span><span class="o">.</span><span class="n">bitcast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
</span><span id="QTensor.dequantize-138"><a href="#QTensor.dequantize-138"><span class="linenos">138</span></a>				<span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">bitcast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">half</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
</span><span id="QTensor.dequantize-139"><a href="#QTensor.dequantize-139"><span class="linenos">139</span></a>				<span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span> <span class="o">*</span> <span class="n">scales</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="n">QK_K</span> <span class="o">//</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="QTensor.dequantize-140"><a href="#QTensor.dequantize-140"><span class="linenos">140</span></a>				
</span><span id="QTensor.dequantize-141"><a href="#QTensor.dequantize-141"><span class="linenos">141</span></a>				<span class="n">tocat</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="QTensor.dequantize-142"><a href="#QTensor.dequantize-142"><span class="linenos">142</span></a>				<span class="k">for</span> <span class="n">shift</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">]:</span>
</span><span id="QTensor.dequantize-143"><a href="#QTensor.dequantize-143"><span class="linenos">143</span></a>					<span class="n">tocat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ql</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">shift</span><span class="p">)</span>
</span><span id="QTensor.dequantize-144"><a href="#QTensor.dequantize-144"><span class="linenos">144</span></a>				<span class="n">ql</span> <span class="o">=</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="o">*</span><span class="n">tocat</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="QTensor.dequantize-145"><a href="#QTensor.dequantize-145"><span class="linenos">145</span></a>				<span class="n">ql</span> <span class="o">=</span> <span class="p">(</span><span class="n">ql</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
</span><span id="QTensor.dequantize-146"><a href="#QTensor.dequantize-146"><span class="linenos">146</span></a>				
</span><span id="QTensor.dequantize-147"><a href="#QTensor.dequantize-147"><span class="linenos">147</span></a>				<span class="n">tocat</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="QTensor.dequantize-148"><a href="#QTensor.dequantize-148"><span class="linenos">148</span></a>				<span class="k">for</span> <span class="n">shift</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">]:</span>
</span><span id="QTensor.dequantize-149"><a href="#QTensor.dequantize-149"><span class="linenos">149</span></a>					<span class="n">tocat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qh</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">shift</span><span class="p">)</span>
</span><span id="QTensor.dequantize-150"><a href="#QTensor.dequantize-150"><span class="linenos">150</span></a>				<span class="n">qh</span> <span class="o">=</span> <span class="n">tinygrad</span><span class="o">.</span><span class="n">Tensor</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="o">*</span><span class="n">tocat</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="QTensor.dequantize-151"><a href="#QTensor.dequantize-151"><span class="linenos">151</span></a>				<span class="n">qh</span> <span class="o">=</span> <span class="p">(</span><span class="n">qh</span> <span class="o">&amp;</span> <span class="mh">0x03</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">n_blocks</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">))</span>
</span><span id="QTensor.dequantize-152"><a href="#QTensor.dequantize-152"><span class="linenos">152</span></a>				<span class="n">q</span> <span class="o">=</span> <span class="p">(</span><span class="n">ql</span> <span class="o">|</span> <span class="p">(</span><span class="n">qh</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span> <span class="o">-</span> <span class="mi">32</span>
</span><span id="QTensor.dequantize-153"><a href="#QTensor.dequantize-153"><span class="linenos">153</span></a>				<span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="n">QK_K</span> <span class="o">//</span> <span class="mi">16</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">dtypes</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
</span><span id="QTensor.dequantize-154"><a href="#QTensor.dequantize-154"><span class="linenos">154</span></a>				<span class="n">blocks</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span> <span class="o">*</span> <span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">n_blocks</span><span class="p">,</span> <span class="n">QK_K</span><span class="p">))</span>
</span><span id="QTensor.dequantize-155"><a href="#QTensor.dequantize-155"><span class="linenos">155</span></a>			<span class="k">else</span><span class="p">:</span>
</span><span id="QTensor.dequantize-156"><a href="#QTensor.dequantize-156"><span class="linenos">156</span></a>				<span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_get_ggml_qtype_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_qtype</span><span class="p">)</span><span class="si">}</span><span class="s2"> dequantization not yet implemented&quot;</span><span class="p">)</span>
</span><span id="QTensor.dequantize-157"><a href="#QTensor.dequantize-157"><span class="linenos">157</span></a>			
</span><span id="QTensor.dequantize-158"><a href="#QTensor.dequantize-158"><span class="linenos">158</span></a>			<span class="c1"># sanity check present in original gguf code</span>
</span><span id="QTensor.dequantize-159"><a href="#QTensor.dequantize-159"><span class="linenos">159</span></a>			<span class="k">assert</span> <span class="n">blocks</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">dtypes</span><span class="o">.</span><span class="n">float</span>
</span><span id="QTensor.dequantize-160"><a href="#QTensor.dequantize-160"><span class="linenos">160</span></a>			<span class="k">assert</span> <span class="n">blocks</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_block_size</span>
</span><span id="QTensor.dequantize-161"><a href="#QTensor.dequantize-161"><span class="linenos">161</span></a>			
</span><span id="QTensor.dequantize-162"><a href="#QTensor.dequantize-162"><span class="linenos">162</span></a>			<span class="c1"># reshape into proper tensor shape</span>
</span><span id="QTensor.dequantize-163"><a href="#QTensor.dequantize-163"><span class="linenos">163</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">_dequantized</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">*</span><span class="n">quant_shape_from_byte_shape</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qtype</span><span class="p">)</span> <span class="p">)</span>
</span><span id="QTensor.dequantize-164"><a href="#QTensor.dequantize-164"><span class="linenos">164</span></a>			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dequantized</span>
</span><span id="QTensor.dequantize-165"><a href="#QTensor.dequantize-165"><span class="linenos">165</span></a>		
</span><span id="QTensor.dequantize-166"><a href="#QTensor.dequantize-166"><span class="linenos">166</span></a>		<span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
</span><span id="QTensor.dequantize-167"><a href="#QTensor.dequantize-167"><span class="linenos">167</span></a><span class="w">			</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="QTensor.dequantize-168"><a href="#QTensor.dequantize-168"><span class="linenos">168</span></a><span class="sd">			@public</span>
</span><span id="QTensor.dequantize-169"><a href="#QTensor.dequantize-169"><span class="linenos">169</span></a><span class="sd">			Provides a wrapper that allows</span>
</span><span id="QTensor.dequantize-170"><a href="#QTensor.dequantize-170"><span class="linenos">170</span></a><span class="sd">			```</span>
</span><span id="QTensor.dequantize-171"><a href="#QTensor.dequantize-171"><span class="linenos">171</span></a><span class="sd">			self.attribute</span>
</span><span id="QTensor.dequantize-172"><a href="#QTensor.dequantize-172"><span class="linenos">172</span></a><span class="sd">			```</span>
</span><span id="QTensor.dequantize-173"><a href="#QTensor.dequantize-173"><span class="linenos">173</span></a><span class="sd">			</span>
</span><span id="QTensor.dequantize-174"><a href="#QTensor.dequantize-174"><span class="linenos">174</span></a><span class="sd">			to be treated as</span>
</span><span id="QTensor.dequantize-175"><a href="#QTensor.dequantize-175"><span class="linenos">175</span></a><span class="sd">			</span>
</span><span id="QTensor.dequantize-176"><a href="#QTensor.dequantize-176"><span class="linenos">176</span></a><span class="sd">			```</span>
</span><span id="QTensor.dequantize-177"><a href="#QTensor.dequantize-177"><span class="linenos">177</span></a><span class="sd">			self.dequantize().attribute</span>
</span><span id="QTensor.dequantize-178"><a href="#QTensor.dequantize-178"><span class="linenos">178</span></a><span class="sd">			```</span>
</span><span id="QTensor.dequantize-179"><a href="#QTensor.dequantize-179"><span class="linenos">179</span></a><span class="sd">			&quot;&quot;&quot;</span>
</span><span id="QTensor.dequantize-180"><a href="#QTensor.dequantize-180"><span class="linenos">180</span></a>			<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tg</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
</span><span id="QTensor.dequantize-181"><a href="#QTensor.dequantize-181"><span class="linenos">181</span></a>				<span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dequantize</span><span class="p">(),</span> <span class="n">attr</span><span class="p">)</span>
</span><span id="QTensor.dequantize-182"><a href="#QTensor.dequantize-182"><span class="linenos">182</span></a>			<span class="k">else</span><span class="p">:</span>
</span><span id="QTensor.dequantize-183"><a href="#QTensor.dequantize-183"><span class="linenos">183</span></a>				<span class="k">raise</span> <span class="ne">AttributeError</span>
</span></pre></div>


            <div class="docstring"><p>Returns the dequantized tensor, unrealized.</p>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>